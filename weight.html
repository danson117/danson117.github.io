<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>信唯 & 啟淳 成長記錄</title>
    
    <!-- 核心 React 庫 -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>

    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f3f4f6; }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .no-select { -webkit-user-select: none; user-select: none; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .active-scale:active { transform: scale(0.95); }
        
        /* 針對 iPad/桌面優化的 Modal 樣式 */
        .modal-center {
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        const { motion, AnimatePresence } = window.Motion;
        
        const safeStorage = {
            getItem: (key) => {
                try { return localStorage.getItem(key); } 
                catch (e) { return null; }
            },
            setItem: (key, value) => {
                try { localStorage.setItem(key, value); } 
                catch (e) {}
            }
        };

        const KG_TO_LBS = 2.20462262;
        const STORAGE_KEY = 'growth_records_v6_ipad_fix'; 
        
        const PRELOAD_DATA = [
            { id: 'sw_1', date: '2026-01-09', person: 'shunwai', weight: 22.85, height: 130 },
            { id: 'sw_2', date: '2026-01-10', person: 'shunwai', weight: 22.95, height: null },
            { id: 'sw_3', date: '2026-01-11', person: 'shunwai', weight: 23.10, height: 110.5 },
            { id: 'ks_1', date: '2026-01-09', person: 'kaishun', weight: 20.45, height: 120.5 },
            { id: 'ks_2', date: '2026-01-10', person: 'kaishun', weight: 20.35, height: null },
            { id: 'ks_3', date: '2026-01-11', person: 'kaishun', weight: 20.70, height: 102.5 },
        ];

        const Icons = {
            Star: (p) => <svg {...p} viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>,
            X: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><line x1="18" x2="6" y1="6" y2="18"/><line x1="6" x2="18" y1="6" y2="18"/></svg>,
            List: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>,
            Delete: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 5H9l-7 7 7 7h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2Z"/><line x1="18" x2="12" y1="9" y2="15"/><line x1="12" x2="18" y1="9" y2="15"/></svg>,
            Weight: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="5" r="3"/><path d="M6.5 8a2 2 0 0 0-1.905 1.457L2.1 18.5A2 2 0 0 0 4 21h16a2 2 0 0 0 1.9-2.5l-2.495-9.043A2 2 0 0 0 17.5 8h-11z"/></svg>,
            Calendar: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>,
            Check: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>,
        };

        const getTodayStr = () => new Date().toISOString().split('T')[0];
        const kgToLbs = (kg) => kg * KG_TO_LBS;

        const recalculateRecords = (rawRecords) => {
            const sorted = [...rawRecords].sort((a, b) => new Date(a.date) - new Date(b.date));
            const personStats = { shunwai: { maxLbs: 0 }, kaishun: { maxLbs: 0 } };

            return sorted.map(record => {
                const lbs = kgToLbs(record.weight);
                const currentMax = personStats[record.person].maxLbs;
                let stickers = 0;
                if (lbs > currentMax) {
                    if (currentMax > 0) {
                        const diff = lbs - currentMax;
                        stickers = Math.floor(diff / 0.1);
                        if (stickers < 0) stickers = 0;
                    }
                    personStats[record.person].maxLbs = lbs;
                }
                return { ...record, stickers, lbs: parseFloat(lbs.toFixed(2)) };
            }).sort((a, b) => new Date(b.date) - new Date(a.date));
        };

        // --- 組件：數字鍵盤 (修正點 1: 限制寬度，適配 iPad) ---
        const CustomKeypad = ({ isOpen, onClose, onConfirm, title, initialValue, suffix }) => {
            const [value, setValue] = useState('');

            useEffect(() => {
                if (isOpen) setValue(initialValue ? String(initialValue) : '');
            }, [isOpen, initialValue]);

            const handlePress = (key) => {
                if (key === 'del') setValue(prev => prev.slice(0, -1));
                else if (key === '.') { if (!value.includes('.')) setValue(prev => prev + '.'); }
                else { if (value.length < 6) setValue(prev => prev + key); }
            };

            // 調整：按鈕高度稍微縮小，更像計算機
            const keyBtnClass = "bg-white active:bg-gray-100 text-2xl font-medium text-gray-800 flex items-center justify-center h-14 sm:h-16";

            return (
                <AnimatePresence>
                    {isOpen && (
                        <>
                            <motion.div initial={{ opacity: 0 }} animate={{ opacity: 0.5 }} exit={{ opacity: 0 }} onClick={onClose} className="fixed inset-0 bg-black z-40" />
                            {/* 容器：使用 flex justify-center 確保在 iPad 上置中 */}
                            <div className="fixed inset-x-0 bottom-0 z-50 flex justify-center pointer-events-none">
                                <motion.div 
                                    initial={{ y: '100%' }} 
                                    animate={{ y: 0 }} 
                                    exit={{ y: '100%' }} 
                                    transition={{ type: 'spring', damping: 25, stiffness: 300 }} 
                                    // 核心修正：max-w-[360px] 限制最大寬度，pointer-events-auto 恢復點擊
                                    className="w-full max-w-[360px] bg-white rounded-t-2xl shadow-2xl overflow-hidden pb-safe pointer-events-auto"
                                >
                                    <div className="bg-gray-50 p-4 flex flex-col items-center justify-center border-b border-gray-200">
                                        <span className="text-gray-500 text-sm mb-1">{title}</span>
                                        <div className="text-4xl font-bold text-gray-800 flex items-baseline h-10">
                                            {value || '0'}
                                            <span className="text-xl text-gray-400 ml-1">{suffix}</span>
                                        </div>
                                    </div>
                                    
                                    <div className="bg-gray-200 grid grid-cols-3 gap-px pb-px border-t border-gray-200">
                                        {['1', '2', '3', '4', '5', '6', '7', '8', '9', '.', '0'].map(key => (
                                            <button key={key} onClick={() => handlePress(key)} className={keyBtnClass}>
                                                {key}
                                            </button>
                                        ))}
                                        <button onClick={() => handlePress('del')} className={`${keyBtnClass} bg-gray-100`}>
                                            <Icons.Delete size={24} className="text-gray-600" />
                                        </button>
                                    </div>

                                    <div className="p-4 bg-white border-t border-gray-100">
                                        <button onClick={() => { onConfirm(value); onClose(); }} className="w-full bg-blue-600 active:bg-blue-700 text-white py-3 rounded-xl font-bold text-lg shadow-md flex items-center justify-center gap-2 transition-transform active:scale-95">
                                            <Icons.Check size={24} /> 確定
                                        </button>
                                    </div>
                                </motion.div>
                            </div>
                        </>
                    )}
                </AnimatePresence>
            );
        };

        // --- 組件：編輯記錄 Modal (修正點 2: 同時修改體重高度) ---
        const EditRecordModal = ({ isOpen, onClose, record, onSave }) => {
            const [w, setW] = useState('');
            const [h, setH] = useState('');

            useEffect(() => {
                if (isOpen && record) {
                    setW(record.weight);
                    setH(record.height || '');
                }
            }, [isOpen, record]);

            const handleSave = () => {
                if (!w) { alert("體重不能為空"); return; }
                onSave({
                    ...record,
                    weight: parseFloat(w),
                    height: h ? parseFloat(h) : null
                });
                onClose();
            };

            return (
                <AnimatePresence>
                    {isOpen && (
                        <>
                            <motion.div initial={{ opacity: 0 }} animate={{ opacity: 0.5 }} exit={{ opacity: 0 }} onClick={onClose} className="fixed inset-0 bg-black z-50" />
                            <div className="fixed inset-0 z-50 flex items-center justify-center p-4 pointer-events-none">
                                <motion.div 
                                    initial={{ scale: 0.9, opacity: 0 }} 
                                    animate={{ scale: 1, opacity: 1 }} 
                                    exit={{ scale: 0.9, opacity: 0 }} 
                                    className="bg-white rounded-2xl shadow-xl w-full max-w-xs overflow-hidden pointer-events-auto"
                                >
                                    <div className="p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50">
                                        <h3 className="font-bold text-gray-800">修改記錄</h3>
                                        <button onClick={onClose}><Icons.X size={24} className="text-gray-500"/></button>
                                    </div>
                                    <div className="p-5 space-y-4">
                                        <div>
                                            <label className="block text-xs font-bold text-gray-400 mb-1">體重 (kg)</label>
                                            <input type="number" value={w} onChange={e => setW(e.target.value)} className="w-full text-xl font-bold border-b-2 border-blue-200 focus:border-blue-500 outline-none py-1 text-center" placeholder="0.0" inputMode="decimal" />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-gray-400 mb-1">高度 (cm)</label>
                                            <input type="number" value={h} onChange={e => setH(e.target.value)} className="w-full text-xl font-bold border-b-2 border-green-200 focus:border-green-500 outline-none py-1 text-center" placeholder="-" inputMode="decimal" />
                                        </div>
                                    </div>
                                    <div className="flex border-t border-gray-100">
                                        <button onClick={onClose} className="flex-1 py-3 text-gray-500 font-bold active:bg-gray-50">取消</button>
                                        <div className="w-px bg-gray-100"></div>
                                        <button onClick={handleSave} className="flex-1 py-3 text-blue-600 font-bold active:bg-blue-50">儲存</button>
                                    </div>
                                </motion.div>
                            </div>
                        </>
                    )}
                </AnimatePresence>
            );
        };

        // --- 組件：歷史記錄 Modal ---
        const HistoryModal = ({ isOpen, onClose, records, onDelete, onEditClick }) => {
            const [filter, setFilter] = useState('all');

            const filteredRecords = records.filter(r => filter === 'all' ? true : r.person === filter);

            const TabButton = ({ id, label, activeColor }) => (
                <button onClick={() => setFilter(id)} className={`flex-1 py-2 text-sm font-bold rounded-lg transition-all ${filter === id ? `${activeColor} text-white shadow-md` : 'bg-gray-100 text-gray-500'}`}>{label}</button>
            );

            return (
                <AnimatePresence>
                    {isOpen && (
                        <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} className="fixed inset-0 bg-white z-40 overflow-hidden flex flex-col pb-safe">
                            <div className="bg-white border-b px-4 py-3 flex justify-between items-center z-10 shadow-sm">
                                <h2 className="text-lg font-bold text-gray-800">全部歷史記錄</h2>
                                <button onClick={onClose} className="p-2 -mr-2 text-gray-800 hover:text-gray-600 transition-colors"><Icons.X size={32} /></button>
                            </div>
                            <div className="p-4 bg-white border-b border-gray-100">
                                <div className="flex gap-2 bg-gray-50 p-1 rounded-xl">
                                    <TabButton id="all" label="全部" activeColor="bg-gray-800" />
                                    <TabButton id="shunwai" label="信唯" activeColor="bg-blue-600" />
                                    <TabButton id="kaishun" label="啟淳" activeColor="bg-green-600" />
                                </div>
                            </div>
                            <div className="flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50">
                                {filteredRecords.length === 0 ? (
                                    <div className="text-center text-gray-400 mt-10">暫無記錄</div>
                                ) : (
                                    filteredRecords.map(r => (
                                        <div key={r.id} className="bg-white p-3 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between gap-2">
                                            <div className="flex items-center gap-3 overflow-hidden">
                                                <div className={`w-1 h-10 rounded-full flex-shrink-0 ${r.person === 'shunwai' ? 'bg-blue-500' : 'bg-green-500'}`}></div>
                                                <div className="flex flex-col">
                                                    <div className="text-[10px] text-gray-400 font-bold">{r.date}</div>
                                                    <div className="font-bold text-gray-800 text-base leading-tight truncate">
                                                        {r.person === 'shunwai' ? '信唯' : '啟淳'} 
                                                        <span className="ml-1.5 text-lg">{r.weight}</span> <span className="text-xs font-normal text-gray-400">kg</span>
                                                        {r.height && <span className="ml-1.5 text-sm text-gray-500">/ {r.height} cm</span>}
                                                    </div>
                                                </div>
                                            </div>
                                            {/* 修正點 2: 文字按鈕 */}
                                            <div className="flex items-center gap-2 flex-shrink-0">
                                                {r.stickers > 0 && (
                                                    <div className="hidden sm:flex items-center gap-0.5 bg-yellow-50 px-1.5 py-0.5 rounded border border-yellow-100 mr-1">
                                                        <Icons.Star size={10} className="text-yellow-500"/>
                                                        <span className="text-[10px] font-bold text-yellow-700">x{r.stickers}</span>
                                                    </div>
                                                )}
                                                <button onClick={() => onEditClick(r)} className="px-3 py-1.5 rounded-lg bg-blue-50 text-blue-600 text-xs font-bold active:bg-blue-100 active-scale">
                                                    修改
                                                </button>
                                                <button onClick={() => onDelete(r.id)} className="px-3 py-1.5 rounded-lg bg-red-50 text-red-600 text-xs font-bold active:bg-red-100 active-scale">
                                                    刪除
                                                </button>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        </motion.div>
                    )}
                </AnimatePresence>
            );
        };

        // --- 主應用 ---
        function WeightTracker() {
            const [records, setRecords] = useState(() => {
                const saved = safeStorage.getItem(STORAGE_KEY);
                return saved ? JSON.parse(saved) : PRELOAD_DATA;
            });
            
            const [sharedDate, setSharedDate] = useState(getTodayStr());
            const [inputState, setInputState] = useState({ shunwai: { weight: '', height: '' }, kaishun: { weight: '', height: '' } });
            const [keypad, setKeypad] = useState({ isOpen: false, person: '', type: '', title: '' });
            const [historyModalOpen, setHistoryModalOpen] = useState(false);
            const [editingRecord, setEditingRecord] = useState(null); // 新增：正在編輯的記錄
            
            const processedRecords = useMemo(() => recalculateRecords(records), [records]);

            useEffect(() => {
                safeStorage.setItem(STORAGE_KEY, JSON.stringify(records));
            }, [records]);

            const getMaxLbs = (person) => {
                const personRecords = processedRecords.filter(r => r.person === person);
                if (personRecords.length === 0) return 0;
                return Math.max(...personRecords.map(r => r.lbs));
            };

            const handleAddRecord = (person) => {
                const data = inputState[person];
                if (!data.weight) { alert('請輸入體重！'); return; }
                const newRecord = {
                    id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
                    date: sharedDate,
                    person,
                    weight: parseFloat(data.weight),
                    height: data.height ? parseFloat(data.height) : null
                };
                setRecords(prev => [...prev, newRecord]);
                setInputState(prev => ({ ...prev, [person]: { weight: '', height: '' } }));
            };

            const handleDelete = (id) => {
                if(confirm('確定要刪除這條記錄嗎？')) {
                    setRecords(prev => prev.filter(r => r.id !== id));
                }
            };

            const handleUpdateRecord = (updatedRecord) => {
                setRecords(prev => prev.map(r => r.id === updatedRecord.id ? updatedRecord : r));
            };

            const openKeypad = (person, type, title) => {
                setKeypad({ isOpen: true, person, type, title, initialValue: inputState[person][type] });
            };

            const onKeypadConfirm = (val) => {
                setInputState(prev => ({ ...prev, [keypad.person]: { ...prev[keypad.person], [keypad.type]: val } }));
            };

            const totalStickers = useMemo(() => {
                return processedRecords.reduce((acc, curr) => {
                    acc[curr.person] += curr.stickers;
                    return acc;
                }, { shunwai: 0, kaishun: 0 });
            }, [processedRecords]);

            // ... (RecentRecordsCard, AdvancedChart, InputCard 代碼保持不變，為節省篇幅省略，但實際運行時需包含) ...
            // 為確保完整性，這裡重複必要的子組件
            const RecentRecordsCard = ({ person, records, title, colorClass, bgClass }) => {
                const myRecords = records.filter(r => r.person === person).slice(0, 5);
                return (
                    <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden flex flex-col">
                        <div className={`${bgClass} px-3 py-2 border-b border-gray-100 flex justify-between items-center`}>
                            <span className={`text-sm font-bold ${colorClass}`}>{title} - 最近紀錄</span>
                        </div>
                        <div className="divide-y divide-gray-100">
                            {myRecords.length === 0 ? <div className="p-4 text-center text-gray-400 text-xs">暫無數據</div> : myRecords.map(r => (
                                <div key={r.id} className="flex justify-between items-center p-3 hover:bg-gray-50 transition-colors">
                                    <div className="flex flex-col"><span className="text-xs text-gray-400 font-medium">{r.date}</span></div>
                                    <div className="flex items-center gap-3">
                                        {r.stickers > 0 && <span className="flex items-center gap-0.5 text-[10px] bg-yellow-100 text-yellow-700 px-1.5 py-0.5 rounded-full font-bold"><Icons.Star size={10} /> +{r.stickers}</span>}
                                        <div className="text-right flex flex-col items-end">
                                            <div className="text-sm font-bold text-gray-800">{r.weight} <span className="text-[10px] font-normal text-gray-400">kg</span></div>
                                            {r.height ? <div className="text-[11px] text-gray-500 font-medium">{r.height} <span className="text-[9px] text-gray-400">cm</span></div> : <div className="text-[10px] text-gray-400">≈ {r.lbs} lbs</div>}
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            const AdvancedChart = ({ records }) => {
                const [mode, setMode] = useState('weight');
                const containerHeight = 200; const containerWidth = 340; const paddingLeft = 35; const paddingRight = 10; const paddingTop = 20; const paddingBottom = 20;
                const validRecords = records.filter(r => mode === 'weight' ? r.weight > 0 : r.height > 0);
                const sortedRecords = [...validRecords].sort((a, b) => new Date(a.date) - new Date(b.date));
                const recentRecords = sortedRecords.slice(-14);

                if (recentRecords.length < 2) return <div className="flex flex-col items-center justify-center h-48 bg-white rounded-2xl border border-gray-200"><div className="flex bg-gray-100 p-1 rounded-lg mb-4"><button onClick={() => setMode('weight')} className={`px-4 py-1 text-xs font-bold rounded-md transition-all ${mode === 'weight' ? 'bg-white shadow text-blue-600' : 'text-gray-400'}`}>體重</button><button onClick={() => setMode('height')} className={`px-4 py-1 text-xs font-bold rounded-md transition-all ${mode === 'height' ? 'bg-white shadow text-blue-600' : 'text-gray-400'}`}>高度</button></div><div className="text-gray-400 text-sm">數據不足</div></div>;

                const getValue = (r) => mode === 'weight' ? r.weight : r.height;
                const values = recentRecords.map(getValue);
                const minV = Math.min(...values) * 0.98; const maxV = Math.max(...values) * 1.02; const range = maxV - minV;
                const swData = recentRecords.filter(r => r.person === 'shunwai'); const ksData = recentRecords.filter(r => r.person === 'kaishun');
                const getX = (dateStr) => { const allDates = recentRecords.map(r => r.date); const uniqueDates = [...new Set(allDates)].sort(); const index = uniqueDates.indexOf(dateStr); const step = (containerWidth - paddingLeft - paddingRight) / (uniqueDates.length - 1 || 1); return paddingLeft + index * step; };
                const getY = (val) => containerHeight - paddingBottom - ((val - minV) / (range || 1)) * (containerHeight - paddingTop - paddingBottom);
                const makePath = (data) => { if (data.length === 0) return ""; return data.map((d, i) => `${i === 0 ? 'M' : 'L'} ${getX(d.date)} ${getY(getValue(d))}`).join(" "); };
                const yLabels = [0, 0.25, 0.5, 0.75, 1].map(p => ({ y: containerHeight - paddingBottom - p * (containerHeight - paddingTop - paddingBottom), val: minV + p * range }));

                return (
                    <div className="bg-white p-4 rounded-2xl shadow-sm border border-gray-200">
                        <div className="flex justify-between items-center mb-4">
                            <h2 className="font-bold text-gray-700 text-sm">趨勢圖表</h2>
                            <div className="flex bg-gray-100 p-1 rounded-lg"><button onClick={() => setMode('weight')} className={`px-3 py-1 text-xs font-bold rounded-md transition-all ${mode === 'weight' ? 'bg-white shadow text-blue-600' : 'text-gray-400'}`}>體重</button><button onClick={() => setMode('height')} className={`px-3 py-1 text-xs font-bold rounded-md transition-all ${mode === 'height' ? 'bg-white shadow text-blue-600' : 'text-gray-400'}`}>高度</button></div>
                        </div>
                        <div className="w-full overflow-x-auto hide-scrollbar">
                            <svg viewBox={`0 0 ${containerWidth} ${containerHeight}`} className="w-full h-full" style={{minWidth: '320px'}}>
                                {yLabels.map((label, i) => (<g key={i}><line x1={paddingLeft} y1={label.y} x2={containerWidth} y2={label.y} stroke="#f3f4f6" strokeWidth="1" /><text x={paddingLeft - 5} y={label.y + 3} textAnchor="end" fontSize="10" fill="#9ca3af" className="font-mono">{label.val.toFixed(1)}</text></g>))}
                                <path d={makePath(swData)} fill="none" stroke="#2563eb" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" />
                                {swData.map((d, i) => (<circle key={`sw-${i}`} cx={getX(d.date)} cy={getY(getValue(d))} r="3" fill="#2563eb" stroke="white" strokeWidth="1" />))}
                                <path d={makePath(ksData)} fill="none" stroke="#16a34a" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" />
                                {ksData.map((d, i) => (<circle key={`ks-${i}`} cx={getX(d.date)} cy={getY(getValue(d))} r="3" fill="#16a34a" stroke="white" strokeWidth="1" />))}
                            </svg>
                        </div>
                        <div className="flex justify-center gap-4 mt-2 text-xs font-bold"><div className="flex items-center gap-1 text-blue-600"><div className="w-2 h-2 rounded-full bg-blue-600"></div> 信唯</div><div className="flex items-center gap-1 text-green-600"><div className="w-2 h-2 rounded-full bg-green-600"></div> 啟淳</div></div>
                    </div>
                );
            };

            const InputCard = ({ person, title, icon: Icon, maxLbs }) => {
                const state = inputState[person];
                const theme = person === 'shunwai' ? { bg: 'bg-blue-600', text: 'text-blue-600', border: 'border-blue-500', light: 'bg-blue-50', btnHover: 'hover:bg-blue-700' } : { bg: 'bg-green-600', text: 'text-green-600', border: 'border-green-500', light: 'bg-green-50', btnHover: 'hover:bg-green-700' };
                return (
                    <div className="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden flex flex-col h-full">
                        <div className={`${theme.bg} p-4 text-white flex justify-between items-center`}><div className="flex items-center gap-2 font-bold text-lg"><div className="bg-white/20 p-1.5 rounded-full"><Icon size={18}/></div>{title}</div><div className="flex flex-col items-end"><div className="text-xs opacity-80">總貼紙</div><div className="font-bold text-xl flex items-center gap-1"><Icons.Star size={16} fill="currentColor" className="text-yellow-300"/> {totalStickers[person]}</div></div></div>
                        <div className="p-4 space-y-4">
                            <div className="bg-yellow-50 border border-yellow-100 rounded-lg p-2 text-center"><span className="text-xs text-yellow-600 font-bold uppercase tracking-wide">當前最高紀錄 (目標)</span><div className="text-xl font-black text-yellow-600">{maxLbs.toFixed(2)} <span className="text-sm font-normal">lbs</span></div></div>
                            <div className="flex gap-2 h-20">
                                <button onClick={() => openKeypad(person, 'weight', `${title}體重`)} className={`flex-1 relative rounded-xl border-2 flex flex-col items-center justify-center transition-all ${state.weight ? `${theme.border} ${theme.light}` : 'border-gray-100 bg-gray-50'}`}><span className="text-xs text-gray-400">體重 (kg)</span><span className={`text-xl font-bold ${state.weight ? theme.text : 'text-gray-300'}`}>{state.weight || '0.0'}</span>{state.weight && <span className="absolute bottom-1 text-[9px] text-gray-400">≈ {(state.weight * KG_TO_LBS).toFixed(1)} lbs</span>}</button>
                                <button onClick={() => openKeypad(person, 'height', `${title}高度`)} className={`flex-1 rounded-xl border-2 flex flex-col items-center justify-center transition-all ${state.height ? `${theme.border} ${theme.light}` : 'border-dashed border-gray-200 bg-gray-50'}`}><span className="text-xs text-gray-400">高度 (cm)</span><span className={`text-xl font-bold ${state.height ? theme.text : 'text-gray-300'}`}>{state.height || '-'}</span></button>
                                <button onClick={() => handleAddRecord(person)} className={`w-16 ${theme.bg} ${theme.btnHover} text-white rounded-xl shadow-md active:scale-95 transition-all flex items-center justify-center font-bold tracking-widest text-sm writing-vertical`}>記錄</button>
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen pb-16 relative">
                    <header className="bg-white sticky top-0 z-30 px-4 py-3 shadow-sm flex justify-between items-center">
                        <h1 className="text-lg font-bold text-gray-800">兄弟成長記錄</h1>
                        <button onClick={() => setHistoryModalOpen(true)} className="flex items-center gap-1 px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-xs font-bold text-gray-600 transition-colors"><Icons.List size={16}/> 歷史記錄</button>
                    </header>
                    <main className="max-w-4xl mx-auto p-4 space-y-6">
                        <div className="bg-white p-3 rounded-xl shadow-sm border border-gray-200 flex items-center gap-3"><div className="bg-gray-100 p-2 rounded-lg text-gray-500"><Icons.Calendar size={20}/></div><div className="flex-1"><label className="text-xs font-bold text-gray-400 block">記錄日期</label><input type="date" value={sharedDate} onChange={(e) => setSharedDate(e.target.value)} className="w-full font-bold text-gray-800 bg-transparent outline-none"/></div></div>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4"><InputCard person="shunwai" title="信唯" icon={Icons.Weight} maxLbs={getMaxLbs('shunwai')} /><InputCard person="kaishun" title="啟淳" icon={Icons.Weight} maxLbs={getMaxLbs('kaishun')} /></div>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4"><RecentRecordsCard person="shunwai" title="信唯" records={processedRecords} colorClass="text-blue-600" bgClass="bg-blue-50" /><RecentRecordsCard person="kaishun" title="啟淳" records={processedRecords} colorClass="text-green-600" bgClass="bg-green-50" /></div>
                        <AdvancedChart records={processedRecords} />
                    </main>

                    <CustomKeypad {...keypad} onClose={() => setKeypad(p => ({...p, isOpen: false}))} onConfirm={onKeypadConfirm} suffix={keypad.type === 'weight' ? 'kg' : 'cm'} />
                    
                    <HistoryModal 
                        isOpen={historyModalOpen} 
                        onClose={() => setHistoryModalOpen(false)} 
                        records={processedRecords} 
                        onDelete={handleDelete} 
                        onEditClick={(r) => setEditingRecord(r)} 
                    />

                    <EditRecordModal 
                        isOpen={!!editingRecord} 
                        onClose={() => setEditingRecord(null)} 
                        record={editingRecord} 
                        onSave={handleUpdateRecord} 
                    />
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<WeightTracker />);
    </script>
</body>
</html>
