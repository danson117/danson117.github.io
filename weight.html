<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>兄弟成長記錄 v1.0.1</title>
    
    <!-- React 核心 -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 樣式與動畫 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    
    <!-- 圖表庫 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.12.0/Recharts.js"></script>

    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f3f4f6; }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .no-select { -webkit-user-select: none; user-select: none; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;
        const { motion, AnimatePresence } = window.Motion;
        
        const RechartsLib = window.Recharts || {};
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Legend } = RechartsLib;

        // --- 常量定義 ---
        const VERSION = "v1.0.1";
        const KG_TO_LBS = 2.20462;
        const NAMES = { brother: '信唯', younger: '啟淳' };
        const COLORS = { 
            brother: { primary: 'blue', bg: 'bg-blue-600', text: 'text-blue-600', border: 'border-blue-500', light: 'bg-blue-50', stroke: '#2563eb' },
            younger: { primary: 'green', bg: 'bg-green-600', text: 'text-green-600', border: 'border-green-500', light: 'bg-green-50', stroke: '#16a34a' }
        };

        // --- 圖標組件 ---
        const Icons = {
            Trash2: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
            Edit2: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>,
            Download: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
            Ruler: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0l12.6 12.6z"/><line x1="14.5" x2="17.5" y1="2.5" y2="5.5"/><line x1="12" x2="15" y1="5" y2="8"/><line x1="9.5" x2="12.5" y1="7.5" y2="10.5"/><line x1="7" x2="10" y1="10" y2="13"/><line x1="4.5" x2="7.5" y1="12.5" y2="15.5"/></svg>,
            Weight: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="5" r="3"/><path d="M6.5 8a2 2 0 0 0-1.905 1.457L2.1 18.5A2 2 0 0 0 4 21h16a2 2 0 0 0 1.9-2.5l-2.495-9.043A2 2 0 0 0 17.5 8h-11z"/></svg>,
            Award: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>,
            Calendar: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>,
            Delete: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 5H9l-7 7 7 7h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2Z"/><line x1="18" x2="12" y1="9" y2="15"/><line x1="12" x2="18" y1="9" y2="15"/></svg>,
            Check: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20 6 9 17 4 12"/></svg>,
            X: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" x2="6" y1="6" y2="18"/><line x1="6" x2="18" y1="6" y2="18"/></svg>,
            TrendingUp: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
            Star: (p) => <svg {...p} viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
            ChevronDown: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="6 9 12 15 18 9"/></svg>,
            ChevronUp: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="18 15 12 9 6 15"/></svg>
        };

        // --- 輔助函數 ---
        const getTodayStr = () => new Date().toISOString().split('T')[0];
        const formatDate = (dateStr) => {
            if (!dateStr) return '';
            const d = new Date(dateStr);
            return `${d.getMonth() + 1}/${d.getDate()}`;
        };

        // --- 數字鍵盤組件 ---
        const CustomKeypad = ({ isOpen, onClose, onConfirm, title, initialValue, suffix }) => {
            const [value, setValue] = useState('');
            useEffect(() => { if (isOpen) setValue(initialValue ? String(initialValue) : ''); }, [isOpen, initialValue]);
            const handlePress = (key) => {
                if (key === 'del') setValue(prev => prev.slice(0, -1));
                else if (key === '.') { if (!value.includes('.')) setValue(prev => prev + '.'); }
                else { if (value.length < 6) setValue(prev => prev + key); }
            };
            const handleConfirm = () => { onConfirm(value); onClose(); };

            return (
                <AnimatePresence>
                    {isOpen && (
                        <>
                            <motion.div initial={{ opacity: 0 }} animate={{ opacity: 0.5 }} exit={{ opacity: 0 }} onClick={onClose} className="fixed inset-0 bg-black z-40" />
                            <motion.div initial={{ y: '100%' }} animate={{ y: 0 }} exit={{ y: '100%' }} transition={{ type: 'spring', damping: 25, stiffness: 300 }} className="fixed bottom-0 left-0 right-0 bg-white z-50 rounded-t-2xl shadow-2xl overflow-hidden pb-safe">
                                <div className="bg-gray-100 p-3 flex flex-col items-center border-b border-gray-200">
                                    <span className="text-gray-500 text-xs mb-1">{title}</span>
                                    <div className="text-3xl font-bold text-gray-800 flex items-baseline">{value || '0'}<span className="text-lg text-gray-400 ml-1">{suffix}</span></div>
                                </div>
                                <div className="grid grid-cols-4 grid-rows-4 gap-px bg-gray-200 h-64 no-select">
                                    <button onClick={() => handlePress('7')} className="bg-white active:bg-gray-200 text-xl font-medium text-gray-800">7</button>
                                    <button onClick={() => handlePress('8')} className="bg-white active:bg-gray-200 text-xl font-medium text-gray-800">8</button>
                                    <button onClick={() => handlePress('9')} className="bg-white active:bg-gray-200 text-xl font-medium text-gray-800">9</button>
                                    <button onClick={() => handlePress('del')} className="bg-gray-100 active:bg-gray-200 text-gray-600 flex items-center justify-center"><Icons.Delete size={24} /></button>
                                    <button onClick={() => handlePress('4')} className="bg-white active:bg-gray-200 text-xl font-medium text-gray-800">4</button>
                                    <button onClick={() => handlePress('5')} className="bg-white active:bg-gray-200 text-xl font-medium text-gray-800">5</button>
                                    <button onClick={() => handlePress('6')} className="bg-white active:bg-gray-200 text-xl font-medium text-gray-800">6</button>
                                    <button onClick={handleConfirm} className="row-span-2 bg-blue-600 active:bg-blue-700 text-white text-lg font-bold flex items-center justify-center" style={{ gridColumn: '4', gridRow: '2 / span 2' }}>確定</button>
                                    <button onClick={() => handlePress('1')} className="bg-white active:bg-gray-200 text-xl font-medium text-gray-800">1</button>
                                    <button onClick={() => handlePress('2')} className="bg-white active:bg-gray-200 text-xl font-medium text-gray-800">2</button>
                                    <button onClick={() => handlePress('3')} className="bg-white active:bg-gray-200 text-xl font-medium text-gray-800">3</button>
                                    <button onClick={() => handlePress('0')} className="col-span-2 bg-white active:bg-gray-200 text-xl font-medium text-gray-800">0</button>
                                    <button onClick={() => handlePress('.')} className="bg-white active:bg-gray-200 text-xl font-medium text-gray-800">.</button>
                                    <div className="bg-gray-100"></div>
                                </div>
                            </motion.div>
                        </>
                    )}
                </AnimatePresence>
            );
        };

        // --- 主程式 ---
        function WeightTracker() {
            // 安全讀取 LocalStorage
            const [records, setRecords] = useState(() => {
                try {
                    const saved = localStorage.getItem('weightRecords_v1');
                    return saved ? JSON.parse(saved) : [];
                } catch (e) {
                    console.warn("LocalStorage access denied. Using temporary storage.");
                    return [];
                }
            });

            // 安全寫入 LocalStorage
            useEffect(() => {
                try {
                    localStorage.setItem('weightRecords_v1', JSON.stringify(records));
                } catch (e) {
                    console.warn("Could not save to LocalStorage:", e);
                }
            }, [records]);

            const [chartRange, setChartRange] = useState('30');
            const [keypadConfig, setKeypadConfig] = useState({ isOpen: false, type: '', initialValue: '', callback: null });
            const [actionMenu, setActionMenu] = useState({ isOpen: false, recordId: null });
            const [viewAll, setViewAll] = useState({ brother: false, younger: false });

            const [inputState, setInputState] = useState({
                brother: { date: getTodayStr(), weight: '', height: '' },
                younger: { date: getTodayStr(), weight: '', height: '' }
            });

            const processedData = useMemo(() => {
                const sorted = [...records].sort((a, b) => new Date(a.date) - new Date(b.date));
                
                const result = { brother: [], younger: [] };
                const maxTracker = { brother: 0, younger: 0 }; 

                sorted.forEach(record => {
                    const p = record.person;
                    const weightLbs = record.weight * KG_TO_LBS;
                    let stickers = 0;
                    let isNewMax = false;

                    if (weightLbs > maxTracker[p]) {
                        if (maxTracker[p] > 0) {
                            const diff = weightLbs - maxTracker[p];
                            stickers = Math.floor(diff / 0.1);
                        } else {
                            stickers = 0; 
                        }
                        maxTracker[p] = weightLbs; 
                        isNewMax = true;
                    }

                    result[p].push({
                        ...record,
                        weightLbs,
                        stickers: stickers > 0 ? stickers : 0,
                        isNewMax,
                        currentMaxLbs: maxTracker[p]
                    });
                });

                return {
                    brother: result.brother.reverse(),
                    younger: result.younger.reverse(),
                    currentMax: maxTracker
                };
            }, [records]);

            const handleAddRecord = (person) => {
                const data = inputState[person];
                if (!data.weight) { alert('請輸入體重！'); return; }
                
                const newItem = {
                    id: Date.now().toString(),
                    date: data.date,
                    person,
                    weight: parseFloat(data.weight),
                    height: data.height ? parseFloat(data.height) : null,
                };

                setRecords(prev => [...prev, newItem]);
                setInputState(prev => ({ ...prev, [person]: { ...prev[person], weight: '', height: '' } }));
            };

            const handleDelete = () => {
                if (actionMenu.recordId) {
                    setRecords(prev => prev.filter(r => r.id !== actionMenu.recordId));
                    setActionMenu({ isOpen: false, recordId: null });
                }
            };

            const exportData = () => {
                const csvContent = "data:text/csv;charset=utf-8," + 
                    "ID,日期,人物,體重(kg),體重(lbs),高度(cm),貼紙,是否破紀錄\n" + 
                    [...processedData.brother, ...processedData.younger]
                    .sort((a,b) => new Date(b.date) - new Date(a.date))
                    .map(e => `${e.id},${e.date},${NAMES[e.person]},${e.weight},${e.weightLbs.toFixed(2)},${e.height || ''},${e.stickers},${e.isNewMax ? '是' : ''}`).join("\n");
                
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", `weight_record_${getTodayStr()}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const chartData = useMemo(() => {
                const allDates = [...new Set(records.map(r => r.date))].sort();
                let filteredDates = allDates;
                if (chartRange !== 'all') {
                    const days = parseInt(chartRange);
                    const cutoffDate = new Date();
                    cutoffDate.setDate(cutoffDate.getDate() - days);
                    filteredDates = allDates.filter(d => new Date(d) >= cutoffDate);
                }
                return filteredDates.map(date => {
                    const b = records.find(r => r.date === date && r.person === 'brother');
                    const y = records.find(r => r.date === date && r.person === 'younger');
                    return {
                        date: formatDate(date),
                        brother: b ? b.weight : null,
                        younger: y ? y.weight : null,
                    };
                });
            }, [records, chartRange]);

            const useLongPress = (callback, ms = 500) => {
                const timerRef = useRef(null);
                const start = () => { timerRef.current = setTimeout(callback, ms); };
                const stop = () => { if (timerRef.current) { clearTimeout(timerRef.current); timerRef.current = null; } };
                return { onMouseDown: start, onMouseUp: stop, onMouseLeave: stop, onTouchStart: start, onTouchEnd: stop };
            };

            const RecordItem = ({ item, colorTheme }) => {
                const longPressProps = useLongPress(() => setActionMenu({ isOpen: true, recordId: item.id }));
                return (
                    <motion.div layout {...longPressProps} className={`relative p-2 rounded-lg mb-1.5 border-l-4 select-none touch-callout-none active:scale-[0.98] transition-all flex justify-between items-center ${item.isNewMax ? 'bg-yellow-50 border-yellow-400' : `${colorTheme.light} ${colorTheme.border}`}`}>
                        <div className="flex items-center gap-3">
                            <div className="text-[10px] text-gray-500 font-mono w-8 text-center leading-tight">{item.date.slice(5).replace('-','/')}</div>
                            <div>
                                <div className="flex items-baseline gap-1">
                                    <span className="text-base font-bold text-gray-800">{item.weight} <span className="text-[10px] font-normal text-gray-500">kg</span></span>
                                    {item.height && <span className="text-[10px] bg-white/60 px-1 rounded text-gray-500 flex items-center ml-1"><Icons.Ruler size={8} className="mr-0.5"/>{item.height}</span>}
                                </div>
                                <div className="text-[10px] text-gray-400">≈ {item.weightLbs.toFixed(1)} lbs</div>
                            </div>
                        </div>
                        <div className="flex items-center gap-1">
                            {item.stickers > 0 && (
                                <div className="flex items-center bg-yellow-100 px-2 py-0.5 rounded-full border border-yellow-200 shadow-sm">
                                    <Icons.Star size={10} className="text-yellow-500 mr-1" />
                                    <span className="text-xs font-bold text-yellow-700">x{item.stickers}</span>
                                </div>
                            )}
                            {item.isNewMax && <span className="text-[10px] bg-red-100 text-red-600 px-1 rounded font-bold ml-1">新高</span>}
                        </div>
                    </motion.div>
                );
            };

            const InputCard = ({ person }) => {
                const name = NAMES[person];
                const theme = COLORS[person];
                const state = inputState[person];
                const data = processedData[person];
                const totalStickers = data.reduce((acc, cur) => acc + cur.stickers, 0);
                const currentMax = processedData.currentMax[person];
                
                const showList = viewAll[person] ? data : data.slice(0, 5);
                const hasMore = data.length > 5;

                const openKeypad = (type, title) => {
                    setKeypadConfig({
                        isOpen: true, type, title, initialValue: state[type], suffix: type === 'weight' ? 'kg' : 'cm',
                        callback: (val) => setInputState(prev => ({ ...prev, [person]: { ...prev[person], [type]: val } }))
                    });
                };

                return (
                    <section className="flex flex-col bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden h-full">
                        <div className={`${theme.bg} text-white p-3 flex justify-between items-center`}>
                            <div className="font-bold text-base flex items-center gap-2">
                                <div className="bg-white/20 p-1 rounded-full"><Icons.Weight size={14}/></div>
                                {name}
                            </div>
                            <div className="flex items-center gap-2">
                                <div className="text-xs bg-black/10 px-2 py-1 rounded text-white/90">
                                    目標: {(currentMax/KG_TO_LBS).toFixed(1)}kg
                                </div>
                                <div className="text-xs bg-yellow-400 text-yellow-900 px-2 py-1 rounded font-bold shadow-sm flex items-center gap-1">
                                    <Icons.Star size={10} /> {totalStickers}
                                </div>
                            </div>
                        </div>

                        <div className="p-3 bg-gray-50 border-b border-gray-100">
                            <div className="flex items-center gap-2 mb-2 bg-white p-1.5 rounded border border-gray-200">
                                <Icons.Calendar size={14} className="text-gray-400 ml-1" />
                                <input type="date" value={state.date} onChange={(e) => setInputState(prev => ({ ...prev, [person]: { ...prev[person], date: e.target.value } }))} className="bg-transparent text-sm font-bold text-gray-600 outline-none w-full"/>
                            </div>
                            <div className="grid grid-cols-2 gap-2">
                                <div onClick={() => openKeypad('weight', `${name}體重`)} className={`p-1.5 rounded border cursor-pointer flex flex-col items-center justify-center bg-white active:bg-gray-50 h-14 ${state.weight ? theme.border : 'border-gray-200'}`}>
                                    <span className="text-[10px] text-gray-400">體重 (kg)</span>
                                    <span className={`text-lg font-bold ${state.weight ? theme.text : 'text-gray-300'}`}>{state.weight || '0.0'}</span>
                                </div>
                                <div onClick={() => openKeypad('height', `${name}高度`)} className={`p-1.5 rounded border cursor-pointer flex flex-col items-center justify-center bg-white active:bg-gray-50 h-14 ${state.height ? theme.border : 'border-dashed border-gray-300'}`}>
                                    <span className="text-[10px] text-gray-400">高度 (cm)</span>
                                    <span className={`text-lg font-bold ${state.height ? theme.text : 'text-gray-300'}`}>{state.height || '-'}</span>
                                </div>
                            </div>
                            <button onClick={() => handleAddRecord(person)} className={`w-full mt-2 py-2 ${theme.bg} hover:opacity-90 text-white rounded-lg font-bold text-sm shadow-sm active:scale-[0.98] transition-all flex justify-center items-center gap-1`}>
                                <Icons.Check size={16} /> 記錄
                            </button>
                        </div>

                        <div className="flex-1 p-3 bg-white">
                            <div className="flex justify-between items-center mb-2">
                                <h3 className="text-[10px] font-bold text-gray-400 uppercase tracking-wider">最近記錄</h3>
                            </div>
                            <div className="space-y-1">
                                {showList.map(item => <RecordItem key={item.id} item={item} colorTheme={theme} />)}
                                {data.length === 0 && <div className="text-center text-gray-300 text-xs py-4">暫無記錄</div>}
                            </div>
                            {hasMore && (
                                <button 
                                    onClick={() => setViewAll(prev => ({...prev, [person]: !prev[person]}))}
                                    className="w-full mt-2 py-1.5 text-xs text-gray-500 bg-gray-50 hover:bg-gray-100 rounded border border-gray-100 flex items-center justify-center gap-1 transition-colors"
                                >
                                    {viewAll[person] ? <><Icons.ChevronUp size={12}/> 收起</> : <><Icons.ChevronDown size={12}/> 查看全部 ({data.length})</>}
                                </button>
                            )}
                        </div>
                    </section>
                );
            };

            return (
                <div className="min-h-screen pb-10 font-sans text-gray-800">
                    <header className="bg-white shadow-sm sticky top-0 z-30 px-4 py-3 flex justify-between items-center">
                        <div className="flex items-center gap-2">
                            <div className="bg-gradient-to-br from-yellow-400 to-orange-500 p-1.5 rounded-lg text-white shadow-sm"><Icons.Award size={18} /></div>
                            <h1 className="text-base font-bold text-gray-800">兄弟成長記錄</h1>
                        </div>
                        <button onClick={exportData} className="p-2 bg-gray-50 rounded-full hover:bg-gray-100 text-gray-500 active:scale-95"><Icons.Download size={18} /></button>
                    </header>

                    <main className="w-full max-w-5xl mx-auto p-3 space-y-4">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 items-start">
                            <InputCard person="brother" />
                            <InputCard person="younger" />
                        </div>

                        <section className="bg-white p-3 rounded-xl shadow-sm border border-gray-200">
                            <div className="flex justify-between items-center mb-2">
                                <h2 className="font-bold text-sm text-gray-700 flex items-center gap-2"><Icons.TrendingUp className="text-purple-500" size={16}/> 體重趨勢</h2>
                                <div className="flex bg-gray-100 rounded p-0.5 text-[10px] font-medium">
                                    {['30', '90', 'all'].map(r => (
                                        <button key={r} onClick={() => setChartRange(r)} className={`px-2 py-1 rounded transition-all ${chartRange === r ? 'bg-white shadow text-purple-600' : 'text-gray-400'}`}>{r === 'all' ? '全部' : `${r}天`}</button>
                                    ))}
                                </div>
                            </div>
                            <div className="h-60 w-full text-xs">
                                {window.Recharts ? (
                                    <ResponsiveContainer width="100%" height="100%">
                                        <LineChart data={chartData} margin={{ top: 10, right: 10, left: -20, bottom: 0 }}>
                                            <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f0f0f0" />
                                            <XAxis dataKey="date" tick={{fontSize: 10, fill: '#9ca3af'}} tickLine={false} axisLine={false} dy={5} />
                                            <YAxis domain={['auto', 'auto']} tick={{fontSize: 10, fill: '#9ca3af'}} tickLine={false} axisLine={false} />
                                            <Tooltip contentStyle={{ borderRadius: '8px', border: 'none', boxShadow: '0 4px 12px rgba(0,0,0,0.1)', fontSize: '12px' }} />
                                            <Legend wrapperStyle={{fontSize: '10px', paddingTop: '10px'}}/>
                                            <Line type="monotone" dataKey="brother" name={NAMES.brother} stroke={COLORS.brother.stroke} strokeWidth={2} dot={{r:2}} activeDot={{r:4}} connectNulls />
                                            <Line type="monotone" dataKey="younger" name={NAMES.younger} stroke={COLORS.younger.stroke} strokeWidth={2} dot={{r:2}} activeDot={{r:4}} connectNulls />
                                        </LineChart>
                                    </ResponsiveContainer>
                                ) : (
                                    <div className="flex items-center justify-center h-full text-gray-400 bg-gray-50 rounded-lg">圖表加載中...</div>
                                )}
                            </div>
                        </section>
                    </main>

                    <div className="fixed bottom-2 right-2 text-[10px] text-gray-300 font-mono pointer-events-none">{VERSION}</div>

                    <CustomKeypad isOpen={keypadConfig.isOpen} onClose={() => setKeypadConfig(prev => ({ ...prev, isOpen: false }))} onConfirm={keypadConfig.callback} title={keypadConfig.title} initialValue={keypadConfig.initialValue} suffix={keypadConfig.suffix} />
                    
                    <AnimatePresence>
                        {actionMenu.isOpen && (
                            <>
                                <motion.div initial={{ opacity: 0 }} animate={{ opacity: 0.5 }} exit={{ opacity: 0 }} onClick={() => setActionMenu({ isOpen: false, recordId: null })} className="fixed inset-0 bg-black z-40" />
                                <motion.div initial={{ y: '100%' }} animate={{ y: 0 }} exit={{ y: '100%' }} className="fixed bottom-0 left-0 right-0 bg-white z-50 rounded-t-2xl p-4 pb-safe">
                                    <div className="text-center text-gray-500 text-sm mb-4">操作記錄</div>
                                    <button onClick={handleDelete} className="w-full py-3 bg-red-50 text-red-600 rounded-xl font-bold flex items-center justify-center gap-2 mb-2"><Icons.Trash2 size={20} /> 刪除此記錄</button>
                                    <button onClick={() => setActionMenu({ isOpen: false, recordId: null })} className="w-full py-3 bg-gray-100 text-gray-600 rounded-xl font-bold">取消</button>
                                </motion.div>
                            </>
                        )}
                    </AnimatePresence>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<WeightTracker />);
    </script>
</body>
</html>
