<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小學四年級中文作文範本集 (完整修復版)</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --active-color: #27ae60;
            --bg-color: #f8f9fa;
            --sidebar-width: 320px;
            --highlight-color: #fff176;
            --highlight-border: #fbc02d;
            --fill-in-bg: #fff9c4;
            --fill-in-border: #fbc02d;
            --blank-text-color: #0056b3;
        }

        body {
            font-family: "Microsoft JhengHei", "PingFang TC", sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            height: 100vh;
            overflow-x: hidden;
        }

        /* --- 遮罩層 --- */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 998;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* --- 自製確認彈窗 (替代 window.confirm) --- */
        .custom-confirm-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 2000;
            width: 300px;
            text-align: center;
            display: none;
        }
        .custom-confirm-modal.active {
            display: block;
        }
        .confirm-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .btn-confirm-yes {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
        .btn-confirm-no {
            background: #ccc;
            color: #333;
            border: none;
            padding: 8px 20px;
            border-radius: 5px;
            cursor: pointer;
        }

        /* --- 側邊選單 --- */
        .sidebar {
            position: fixed;
            top: 0;
            left: -340px;
            width: var(--sidebar-width);
            height: 100%;
            background-color: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            z-index: 999;
            transition: left 0.3s ease-in-out;
            display: flex;
            flex-direction: column;
        }

        .sidebar.open {
            left: 0;
        }

        .sidebar-header {
            padding: 20px;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-header h2 {
            margin: 0;
            font-size: 1.2em;
        }

        .close-menu-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
        }

        .menu-list {
            list-style: none;
            padding: 0;
            margin: 0;
            overflow-y: auto;
            flex: 1;
            padding-bottom: 50px;
        }

        .menu-item {
            padding: 15px 15px 15px 40px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 1em;
            color: #555;
            position: relative;
            background: white;
            user-select: none;
        }

        .menu-item:hover {
            background-color: #f0f0f0;
            color: var(--active-color);
        }

        .menu-item.active {
            background-color: #e8f5e9;
            color: var(--active-color);
            font-weight: bold;
            border-left: 5px solid var(--active-color);
        }

        .menu-item.draggable-item {
            cursor: move;
        }

        .drag-handle {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #ccc;
            font-size: 1.2em;
            cursor: move;
        }

        .menu-item.dragging {
            opacity: 0.5;
            background-color: #e0e0e0;
            border: 2px dashed #999;
        }

        .menu-item.over {
            border-top: 3px solid var(--active-color);
        }
        
        .menu-item.special-item {
            background-color: #fff8e1;
            color: #d35400;
            font-weight: bold;
            border-bottom: 2px solid #ffe0b2;
            padding-left: 20px;
            cursor: pointer;
        }
        .menu-item.special-item:hover {
            background-color: #ffe0b2;
        }
        .menu-item.special-item.active {
            background-color: #ffcc80;
            color: #bf360c;
            border-left: 5px solid #bf360c;
        }

        .reset-order-btn {
            font-size: 0.8em;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.4);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 5px;
        }

        /* --- 主內容區 --- */
        .main-content {
            width: 100%;
            height: 100vh;
            overflow-y: auto;
            padding: 20px;
            box-sizing: border-box;
            position: relative;
        }

        .top-nav {
            position: sticky;
            top: 0;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 0;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            display: flex;
            align-items: center;
            z-index: 100;
            backdrop-filter: blur(5px);
        }

        .menu-toggle-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 5px;
            margin-right: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .nav-title {
            font-weight: bold;
            color: #333;
            font-size: 1.1em;
        }

        /* --- 文章內容樣式 --- */
        .content-section {
            display: none;
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            animation: fadeIn 0.3s ease;
            margin-bottom: 50px;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--active-color);
            padding-bottom: 15px;
            margin-top: 0;
        }

        .structure-tag {
            background-color: #eee;
            color: #555;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            display: inline-block;
            margin-bottom: 20px;
            font-weight: bold;
        }

        h3 {
            color: var(--active-color);
            margin-top: 40px;
            border-left: 4px solid var(--active-color);
            padding-left: 10px;
            background-color: #f9f9f9;
            padding: 10px;
        }

        /* 填充區 */
        .fill-in-box {
            background-color: var(--fill-in-bg);
            border: 2px dashed var(--fill-in-border);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .fill-in-title {
            font-weight: bold;
            color: #f57f17;
            margin-bottom: 15px;
        }

        .blank {
            display: inline-block;
            min-width: 60px;
            border-bottom: 2px solid #555;
            text-align: center;
            color: var(--blank-text-color);
            font-weight: bold;
            padding: 0 5px;
        }

        /* --- 重點標記樣式 --- */
        .article-text p {
            line-height: 2.2;
            font-size: 1.2em;
            margin-bottom: 25px;
            text-align: justify;
        }

        .phrase {
            cursor: pointer;
            border-radius: 4px;
            padding: 2px 1px;
            transition: background-color 0.15s, border-bottom 0.15s;
            position: relative;
        }

        .phrase:hover {
            background-color: #e0e0e0; 
        }

        .phrase.highlight {
            background-color: var(--highlight-color);
            border-bottom: 3px solid var(--highlight-border);
        }

        .btn-clear {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            margin-left: auto;
        }

        .instruction-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #fff3e0;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            border: 1px solid #ffe0b2;
        }

        /* --- 筆記本專用樣式 --- */
        .notebook-input-area {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 1px solid #bbdefb;
        }

        .notebook-input-area h3 {
            margin-top: 0;
            border: none;
            padding: 0;
            background: none;
            color: #1565c0;
        }

        .input-group {
            display: flex;
            gap: 10px;
        }

        #customNoteInput {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
        }

        #addNoteBtn {
            background-color: #1976d2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        #addNoteBtn:hover {
            background-color: #1565c0;
        }

        .notebook-section-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #555;
            margin: 30px 0 15px 0;
            border-bottom: 2px solid #eee;
            padding-bottom: 5px;
        }

        .notebook-list {
            list-style: none;
            padding: 0;
        }

        .notebook-item {
            background: white;
            border: 1px solid #eee;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 5px solid #ccc;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            line-height: 1.6;
        }

        .notebook-item.source-article {
            border-left-color: var(--highlight-border);
            background-color: #fffde7;
        }

        .notebook-item.source-custom {
            border-left-color: #29b6f6;
            background-color: #e1f5fe;
        }

        .notebook-content {
            flex: 1;
        }

        .notebook-source {
            display: block;
            font-size: 0.85em;
            color: #888;
            margin-top: 5px;
            font-weight: bold;
        }

        .delete-note-btn {
            background: none;
            border: none;
            color: #999;
            font-size: 1.2em;
            cursor: pointer;
            margin-left: 10px;
            padding: 0 5px;
        }

        .delete-note-btn:hover {
            color: #e74c3c;
        }

        .empty-msg {
            color: #999;
            font-style: italic;
            text-align: center;
            padding: 20px;
        }

        @media (max-width: 768px) {
            .content-section { padding: 20px; }
            .sidebar { width: 85%; }
            .input-group { flex-direction: column; }
            #addNoteBtn { width: 100%; }
        }
    </style>
</head>
<body>

    <div class="overlay" id="overlay" onclick="closeSidebar()"></div>

    <!-- 自製確認視窗 -->
    <div class="custom-confirm-modal" id="confirmModal">
        <p id="confirmMessage">確定要執行此操作嗎？</p>
        <div class="confirm-buttons">
            <button class="btn-confirm-yes" id="confirmYesBtn">確定</button>
            <button class="btn-confirm-no" onclick="closeConfirmModal()">取消</button>
        </div>
    </div>

    <!-- 側邊選單 -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div>
                <h2>📚 選單</h2>
                <button class="reset-order-btn" onclick="askResetOrder()">重置排序</button>
            </div>
            <button class="close-menu-btn" onclick="closeSidebar()">×</button>
        </div>
        <ul class="menu-list" id="menuList">
            <!-- 筆記本與文章將由 JS 插入 -->
        </ul>
    </div>

    <div class="main-content">
        <div class="top-nav">
            <button class="menu-toggle-btn" onclick="openSidebar()">
                ☰ 目錄
            </button>
            <span class="nav-title" id="currentTitle">請選擇題目</span>
        </div>

        <!-- ================= 筆記本區域 ================= -->
        <div id="notebook-view" class="content-section">
            <h1>🌟 我的重點筆記本</h1>
            <p style="color: #666;">這裡集合了所有你在文章中標記的重點，你也可以自己在下方加入筆記。</p>

            <!-- 自訂筆記輸入區 -->
            <div class="notebook-input-area">
                <h3>✍️ 自行加入好句/筆記</h3>
                <div class="input-group">
                    <input type="text" id="customNoteInput" placeholder="輸入你想記錄的句子或詞語...">
                    <button id="addNoteBtn" onclick="addCustomNote()">加入筆記</button>
                </div>
            </div>

            <!-- 自訂筆記列表 -->
            <div class="notebook-section-title">我的自訂筆記</div>
            <ul id="customNoteList" class="notebook-list">
                <!-- JS 生成 -->
            </ul>

            <!-- 文章重點彙整 -->
            <div class="notebook-section-title">來自文章的重點 (自動同步)</div>
            <ul id="articleHighlightsList" class="notebook-list">
                <!-- JS 生成 -->
            </ul>
        </div>

        <!-- ================= 文章區域 (完整內容) ================= -->
        
        <!-- 1. 一次難忘的經歷 -->
        <div id="topic-1" class="content-section">
            <div class="instruction-bar">
                <span>💡 點擊文字即可標記重點</span>
                <button class="btn-clear" onclick="askClearCurrentHighlights()">清除本頁標記</button>
            </div>
            <h1>一次難忘的經歷</h1>
            <div class="structure-tag">結構：事情起因 ➔ 經過/困難 ➔ 結果 ➔ 感受/得著</div>
            
            <div class="fill-in-box">
                <div class="fill-in-title">📝 萬能填充思考區</div>
                <div class="fill-in-content">
                    <p><strong>第一段 (起)：</strong><span class="blank">(時間)</span>，<span class="blank">(人物)</span>在<span class="blank">(地點)</span><span class="blank">(做甚麼)</span>，因為<span class="blank">(原因)</span>。</p>
                    <p><strong>第二段 (承)：</strong>起初，<span class="blank">(事情開始的情況)</span>，我感到十分<span class="blank">(心情)</span>。突然，<span class="blank">(發生了甚麼意外/變化)</span>。</p>
                    <p><strong>第三段 (轉)：</strong>當時情況<span class="blank">(形容情況)</span>，我<span class="blank">(當時的反應/動作)</span>。幸好/結果，<span class="blank">(問題如何解決/事情的結果)</span>。</p>
                    <p><strong>第四段 (合)：</strong>經過這次<span class="blank">(的經歷/過程)</span>，我明白<span class="blank">(道理/重要性)</span>，正所謂「<span class="blank">(諺語：如經一事長一智)</span>」，我日後<span class="blank">(未來的行動)</span>。</p>
                </div>
            </div>

            <h3>範本一：學踏單車 (克服恐懼)</h3>
            <div class="article-text">
                <p>在我成長的過程中，發生過許多事情，其中最令我難忘的，就是去年暑假學踏單車的經歷。</p>
                <p>那天，爸爸帶我到公園學踏單車。剛開始，我總是掌握不到平衡，車頭搖搖晃晃，嚇得我手心冒汗。突然，「砰」的一聲，我連人帶車摔倒在地上，膝蓋擦破了皮，痛得我眼淚直流，心裡想放棄了。</p>
                <p>爸爸見狀，走過來扶起我，溫柔地鼓勵我說：「失敗乃成功之母，不要怕，再來一次！」聽了爸爸的話，我擦乾眼淚，鼓起勇氣重新騎上單車。經過無數次的跌倒和練習，我終於學會了控制平衡。</p>
                <p>現在，我已經可以在公園裡自由自在地騎車了。這次經歷讓我明白到，只要有恆心，不怕困難，就一定能克服挑戰。</p>
            </div>

            <h3>範本二：迷路記 (驚險教訓)</h3>
            <div class="article-text">
                <p>那是一個星期天的下午，媽媽帶我到人山人海的商場購物。這次經歷，至今仍令我心有餘悸。</p>
                <p>商場裡的玩具店琳瑯滿目，我被櫥窗裡的機械人吸引住了，不知不覺鬆開了媽媽的手。當我回過神來，轉身一看，發現媽媽不見了！我看著周圍陌生的面孔，心裡充滿了恐懼，急得像熱鍋上的螞蟻，眼淚在眼眶裡打轉。</p>
                <p>我想起老師教過我們，迷路時要找警察或保安員。於是我鼓起勇氣，走到詢問處向保安叔叔求助。保安叔叔透過廣播尋找我的媽媽。不一會兒，媽媽焦急地跑過來，緊緊地抱著我，眼裡泛著淚光。</p>
                <p>這次迷路的經歷真是刻骨銘心。所謂「經一事，長一智」，我以後外出時一定要緊跟父母，再也不敢貪玩亂跑了。</p>
            </div>

            <h3>範本三：第一次做飯 (嘗試與成長)</h3>
            <div class="article-text">
                <p>母親節那天，為了給媽媽一個驚喜，我決定親自下廚，做一頓簡單的午餐。這是我第一次做飯，過程既狼狽又難忘。</p>
                <p>我打算煎一隻荷包蛋。我先在平底鍋裡倒油，可是火開得太大了，油煙直冒。當我把雞蛋打進鍋裡時，熱油「滋滋」地濺了出來，嚇得我把鍋鏟都扔掉了，手背也被燙紅了一小塊。</p>
                <p>雖然心裡有點害怕，但我不想半途而廢。我小心翼翼地把火調小，忍著痛繼續煎。終於，一隻金黃色的荷包蛋出鍋了，雖然邊緣有點焦，但我很有成就感。媽媽回家看到我的「傑作」，吃得津津有味，還稱讚我長大了。</p>
                <p>這次下廚的經歷讓我體會到媽媽平日做家務的辛勞。我決定以後要多幫忙做家務，做個孝順的好孩子。</p>
            </div>
        </div>

        <!-- 2. 我做了一件好事 -->
        <div id="topic-2" class="content-section">
            <div class="instruction-bar">
                <span>💡 點擊文字即可標記重點</span>
                <button class="btn-clear" onclick="askClearCurrentHighlights()">清除本頁標記</button>
            </div>
            <h1>我做了一件好事</h1>
            <div class="structure-tag">結構：發現需要幫助的人 ➔ 內心想法 ➔ 行動 ➔ 快樂的結果</div>

            <div class="fill-in-box">
                <div class="fill-in-title">📝 萬能填充思考區</div>
                <div class="fill-in-content">
                    <p><strong>第一段 (起)：</strong>有一天，我在<span class="blank">(地點)</span>看見<span class="blank">(誰)</span>正遇到<span class="blank">(甚麼困難)</span>。</p>
                    <p><strong>第二段 (承)：</strong>當時周圍<span class="blank">(環境描寫)</span>，我心想：<span class="blank">(內心的掙扎或想法)</span>。雖然<span class="blank">(困難點)</span>，但我決定伸出援手。</p>
                    <p><strong>第三段 (轉)：</strong>於是我<span class="blank">(具體行動)</span>。對方看到我幫忙，感動地說：「<span class="blank">(感謝的話)</span>。」</p>
                    <p><strong>第四段 (合)：</strong>這件事讓我感到<span class="blank">(心情)</span>，因為我明白了「助人為快樂之本」的道理。</p>
                </div>
            </div>

            <h3>範本一：路不拾遺 (誠實)</h3>
            <div class="article-text">
                <p>上週六，我在公園的長椅上休息時，發現旁邊有一個黑色的錢包。我撿起來一看，裡面有身份證和不少現金。</p>
                <p>當時四下無人，我心裡猶豫了一下：如果拿走這些錢，就可以買很多玩具了。但是，我想起爸爸教導我要誠實，失主現在一定很著急。於是我打消了貪念，決定留在原地等待失主。</p>
                <p>過了半小時，一位叔叔滿頭大汗地跑過來，在長椅附近東張西望。我走上前確認後，把錢包歸還給他。叔叔激動地握著我的手說：「太謝謝你了！這是我的救命錢啊！」</p>
                <p>看著叔叔失而復得的笑容，我感到無比輕鬆和快樂。這件事讓我明白，誠實和助人比金錢更珍貴。</p>
            </div>

            <h3>範本二：扶老奶奶過馬路 (關愛)</h3>
            <div class="article-text">
                <p>放學回家的路上，我在十字路口等待綠燈。這時，我看見一位白髮蒼蒼的老奶奶，手裡提著兩袋沉甸甸的菜，正艱難地站在路邊。</p>
                <p>綠燈亮了，行人匆匆忙忙地走過，老奶奶卻因為行動緩慢，才走了幾步，紅燈又快亮了，情況十分危險。我見狀，二話不說，立刻跑過去扶著老奶奶的手臂。</p>
                <p>我一邊幫她提起一袋菜，一邊輕聲說：「婆婆，小心車，我扶您過去。」我們慢慢地走到對面馬路。老奶奶摸著我的頭，笑著說：「乖孩子，真是多謝你啊！」</p>
                <p>雖然這只是一件微不足道的小事，但看到老奶奶平安過馬路，我的心裡像吃了蜜糖一樣甜。原來幫助別人，自己也會得到快樂。</p>
            </div>

            <h3>範本三：安慰同學 (同理心)</h3>
            <div class="article-text">
                <p>今天小息的時候，我發現坐在後排的小明趴在桌子上，肩膀一聳一聳的，似乎在哭泣。</p>
                <p>我走近一看，原來他不小心把心愛的圖書撕破了。那可是他剛買的新書啊！同學們都在玩耍，沒有人注意到他。我心裡很同情他，決定過去安慰他。</p>
                <p>我拿出紙巾遞給他，輕輕拍著他的背說：「別哭了，我們一起想辦法修補吧。」我從書包裡拿出透明膠帶，小心翼翼地幫他把撕破的頁面黏好。雖然有一點痕跡，但書本總算完整了。小明擦乾眼淚，破涕為笑。</p>
                <p>這次經歷讓我學會了關心同學。一句安慰的話，一個小小的幫忙，都能給別人帶來溫暖。</p>
            </div>
        </div>

        <!-- 3. 一次生病的經過 -->
        <div id="topic-3" class="content-section">
            <div class="instruction-bar">
                <span>💡 點擊文字即可標記重點</span>
                <button class="btn-clear" onclick="askClearCurrentHighlights()">清除本頁標記</button>
            </div>
            <h1>一次生病的經過</h1>
            <div class="structure-tag">結構：生病原因 ➔ 病徵/痛苦 ➔ 看醫生/家人照顧 ➔ 康復/健康的重要</div>

            <div class="fill-in-box">
                <div class="fill-in-title">📝 萬能填充思考區</div>
                <div class="fill-in-content">
                    <p><strong>第一段 (起)：</strong>最近天氣<span class="blank">(天氣變化)</span>，我因為<span class="blank">(原因：如貪吃/少穿衣)</span>，結果生病了。</p>
                    <p><strong>第二段 (承)：</strong>我覺得<span class="blank">(病徵：頭痛/肚痛/發燒)</span>，整個人<span class="blank">(形容感覺)</span>。媽媽見狀，十分<span class="blank">(心情)</span>。</p>
                    <p><strong>第三段 (轉)：</strong>醫生說我患了<span class="blank">(病名)</span>，需要<span class="blank">(治療方法)</span>。在家休息期間，媽媽<span class="blank">(照顧的動作)</span>，讓我感到很溫暖。</p>
                    <p><strong>第四段 (合)：</strong>經過幾天的休息，我終於康復了。我明白到「健康勝於財富」，以後會<span class="blank">(承諾)</span>。</p>
                </div>
            </div>

            <h3>範本一：感冒發燒 (天氣轉涼)</h3>
            <div class="article-text">
                <p>上星期，天氣突然轉涼，我因為沒有穿足夠的衣服，結果感冒了。那天晚上，我覺得渾身發冷，頭痛欲裂，整個人迷迷糊糊的。</p>
                <p>媽媽摸了摸我的額頭，驚叫道：「哎呀！好燙啊！」她連忙拿出探熱針，原來我發燒到三十九度。媽媽整晚沒睡，一會兒餵我吃藥，一會兒用濕毛巾幫我降溫。</p>
                <p>第二天，我不得不請假去看醫生。醫生說我是重感冒，要多休息。躺在床上，聽著窗外同學們上學的聲音，我真後悔沒有好好照顧自己。</p>
                <p>經過幾天的休息，我終於康復了。這次生病讓我深刻體會到「健康勝於財富」的道理。以後我一定會注意天氣變化，適時添衣。</p>
            </div>

            <h3>範本二：吃壞肚子 (貪吃惹禍)</h3>
            <div class="article-text">
                <p>我是個著名的「小饞貓」，看到美食就忍不住。前天路邊的小販在賣魚蛋，香氣撲鼻，我一口氣吃了兩串。</p>
                <p>回到家不久，我的肚子就開始「咕嚕咕嚕」地叫，接著是一陣陣劇痛，像有把刀在肚子裡攪動一樣。我跑了無數次廁所，拉得雙腿發軟，臉色蒼白。</p>
                <p>爸爸趕緊帶我去看醫生。醫生檢查後說我是「急性腸胃炎」，是因為吃了不潔的食物。我看著那苦澀的藥水，心裡後悔極了。這幾天只能吃清淡的白粥，看著桌上的雞腿卻不能吃，真是痛苦。</p>
                <p>這次慘痛的教訓讓我明白了飲食衛生的重要。我發誓以後再也不亂吃街邊不乾淨的食物了。</p>
            </div>

            <h3>範本三：牙痛慘過大病 (不愛刷牙)</h3>
            <div class="article-text">
                <p>俗語說：「牙痛慘過大病。」這句話我最近終於深深體會到了。我平日最愛吃糖果，又常常偷懶不刷牙。</p>
                <p>前天晚上，我的牙齒突然劇烈疼痛起來，半邊臉都腫了。那種痛楚鑽進心裡，讓我坐立不安，連覺都睡不著，只能抱著枕頭在那裡哼哼唧唧。</p>
                <p>第二天，媽媽帶我去看牙醫。牙醫檢查後，嚴肅地說我有嚴重的蛀牙，需要補牙。當電鑽在我的牙齒上「滋滋」作響時，我嚇得緊緊抓住扶手，眼淚直流。經過一番折騰，牙痛終於止住了。</p>
                <p>從那天起，我把家裡的糖果都送人了，並且堅持早晚刷牙。因為我再也不想經歷那種可怕的牙痛了。</p>
            </div>
        </div>

        <!-- 4. 快樂的聖誕聯歡會 -->
        <div id="topic-4" class="content-section">
            <div class="instruction-bar">
                <span>💡 點擊文字即可標記重點</span>
                <button class="btn-clear" onclick="askClearCurrentHighlights()">清除本頁標記</button>
            </div>
            <h1>快樂的聖誕聯歡會</h1>
            <div class="structure-tag">結構：會前氣氛/佈置 ➔ 表演/遊戲/大食會 ➔ 抽獎高潮 ➔ 結束感受</div>

            <div class="fill-in-box">
                <div class="fill-in-title">📝 萬能填充思考區</div>
                <div class="fill-in-content">
                    <p><strong>第一段 (起)：</strong><span class="blank">(日期)</span>是學校的聖誕聯歡會，校園裡洋溢著<span class="blank">(氣氛)</span>。課室被佈置得<span class="blank">(形容詞)</span>。</p>
                    <p><strong>第二段 (承)：</strong>聯歡會開始了，我們先進行<span class="blank">(活動：大食會/表演)</span>。大家一邊<span class="blank">(動作)</span>，一邊<span class="blank">(動作)</span>，十分開心。</p>
                    <p><strong>第三段 (轉)：</strong>接著是大家最期待的<span class="blank">(高潮活動：抽獎/遊戲)</span>。當老師抽出大獎時，全班都<span class="blank">(反應)</span>，結果由<span class="blank">(誰)</span>獲獎。</p>
                    <p><strong>第四段 (合)：</strong>這次聯歡會在一片歡笑聲中結束。我不但<span class="blank">(收穫)</span>，還增進了同學間的友誼，真是一個<span class="blank">(形容詞)</span>的聖誕節。</p>
                </div>
            </div>

            <h3>範本一：班級派對 (綜合描寫)</h3>
            <div class="article-text">
                <p>十二月二十日，學校充滿了濃厚的節日氣氛。為了慶祝聖誕節，我們班舉行了一個盛大的聯歡會。</p>
                <p>課室被佈置得美輪美奐，黑板上畫滿了聖誕老人和雪人。聯歡會開始了，首先是大食會。桌上擺滿了雞翼、薯片、三文治等美食，大家一邊品嚐美食，一邊談天說地。</p>
                <p>接著是才藝表演和遊戲環節。小明表演的魔術神奇極了，看得我們目瞪口呆。我們還玩了「爭椅子」遊戲，過程緊張刺激，大家都玩得滿頭大汗。</p>
                <p>快樂的時光過得特別快，聯歡會在一片歡呼聲中結束了。這次聯歡會不但讓我們放鬆了心情，還增進了師生之間的感情，真是一個難忘的聖誕節。</p>
            </div>

            <h3>範本二：交換禮物 (驚喜時刻)</h3>
            <div class="article-text">
                <p>一年一度的聖誕聯歡會終於來臨了，我最期待的就是「交換禮物」環節。為了這一天，我精心挑選了一本有趣的圖書包裝好帶回學校。</p>
                <p>聯歡會上，老師把所有禮物堆放在中間，像一座小山。抽籤開始了，我的心「怦怦」直跳，希望能抽到一份好禮物。輪到我了，我閉上眼睛抽了一個號碼，對應的是一個包裝精美的藍色盒子。</p>
                <p>我迫不及待地拆開一看，哇！原來是一盒顏色筆，正是我想要的！送禮物的同學看見我這麼喜歡，也露出了滿意的笑容。看著同學們拆禮物時驚喜或搞笑的表情，課室裡充滿了歡笑聲。</p>
                <p>這次交換禮物讓我明白了「施比受更有福」的道理。大家分享的不僅是禮物，更是一份份溫暖的祝福。</p>
            </div>

            <h3>範本三：精彩的才藝表演 (欣賞與參與)</h3>
            <div class="article-text">
                <p>今年的聖誕聯歡會特別熱鬧，因為老師安排了才藝表演大賽。同學們都施展渾身解數，準備大顯身手。</p>
                <p>首先出場的是小華，他拉奏的小提琴曲《聖誕快樂》悠揚動聽，大家都聽得如痴如醉。接著是一組女同學的跳舞表演，她們動作整齊，充滿活力，贏得了全場熱烈的掌聲。</p>
                <p>我也鼓起勇氣上台講了一個笑話。剛開始我有點緊張，說話結結巴巴的。但看到同學們鼓勵的眼神，我放鬆下來，講得繪聲繪色，最後逗得大家捧腹大笑。老師還頒了一個「最幽默獎」給我呢！</p>
                <p>這次聯歡會提供了一個舞台讓我們展現才華，也讓我變得更有自信。這真是我度過的最有意義的一個聖誕節。</p>
            </div>
        </div>

        <!-- 5. 受傷了 -->
        <div id="topic-5" class="content-section">
            <div class="instruction-bar">
                <span>💡 點擊文字即可標記重點</span>
                <button class="btn-clear" onclick="askClearCurrentHighlights()">清除本頁標記</button>
            </div>
            <h1>受傷了</h1>
            <div class="structure-tag">結構：受傷原因(通常是疏忽) ➔ 受傷經過/痛楚 ➔ 治療/他人關懷 ➔ 教訓</div>

            <div class="fill-in-box">
                <div class="fill-in-title">📝 萬能填充思考區</div>
                <div class="fill-in-content">
                    <p><strong>第一段 (起)：</strong>那天<span class="blank">(時間)</span>，我在<span class="blank">(地點)</span><span class="blank">(做甚麼)</span>。因為我<span class="blank">(原因：不小心/貪玩)</span>，發生了意外。</p>
                    <p><strong>第二段 (承)：</strong>突然，「砰」的一聲，我<span class="blank">(受傷的動作)</span>。我感到<span class="blank">(痛楚描寫)</span>，低頭一看，發現<span class="blank">(傷勢)</span>。</p>
                    <p><strong>第三段 (轉)：</strong><span class="blank">(誰)</span>見狀，立刻幫我<span class="blank">(處理方法)</span>。看著傷口，我感到十分<span class="blank">(心情)</span>。</p>
                    <p><strong>第四段 (合)：</strong>經過這次教訓，我明白到<span class="blank">(道理：安全第一)</span>，以後做事一定會<span class="blank">(改進)</span>。</p>
                </div>
            </div>

            <h3>範本一：走廊奔跑 (魯莽)</h3>
            <div class="article-text">
                <p>記得那是三年級的時候，發生了一件令我後悔不已的事。那天小息，因為趕著去操場霸佔球場，我在走廊上飛快地奔跑。</p>
                <p>正當我得意忘形時，腳下一滑，整個人向前撲倒。「砰」的一聲，我的膝蓋重重地撞在硬邦邦的地板上。一陣劇痛傳遍全身，我低頭一看，膝蓋鮮血直流。</p>
                <p>老師聞聲趕來，立刻帶我去醫療室消毒和包紮。看著紅紅的藥水塗在傷口上，我痛得齜牙咧嘴。回到家後，媽媽看到我的傷口，既心疼又生氣地責備我不小心。</p>
                <p>這次受傷讓我足足痛了一個星期。我深深地吸取了教訓，以後在走廊一定要慢慢走，絕不再魯莽奔跑了。</p>
            </div>

            <h3>範本二：切水果 (不小心)</h3>
            <div class="article-text">
                <p>星期天下午，家裡只有我一個人。我覺得口渴，看見桌上有幾個蘋果，便拿起水果刀想削蘋果吃。</p>
                <p>平日看媽媽削蘋果好像很容易，誰知輪到自己動手時，那把刀卻不聽使喚。我用力一削，刀子一滑，鋒利的刀刃劃破了我的左手食指。鮮血頓時湧了出來，我嚇得大叫一聲，手足無措。</p>
                <p>我連忙用紙巾按住傷口，可是血還是止不住。幸好這時媽媽回來了，她趕緊幫我止血並貼上膠布。看著被包得像粽子一樣的手指，我心裡充滿了悔意。</p>
                <p>這次意外讓我明白，使用利器時要格外小心，不能逞強。小孩子做危險的事情前，一定要先得到大人的同意。</p>
            </div>

            <h3>範本三：打籃球 (運動意外)</h3>
            <div class="article-text">
                <p>我是一個籃球迷，每逢假日都會到球場打球。上週六，我和幾個朋友進行了一場激烈的籃球比賽。</p>
                <p>比賽進行到最後一分鐘，雙方分數打平。為了搶一個籃板球，我高高跳起。落地時，我不小心踩到了別人的腳，腳踝猛地一扭，整個人摔倒在地。一陣鑽心的疼痛從腳踝傳來，我痛得抱著腳在地上打滾。</p>
                <p>朋友們立刻停止比賽，合力把我扶到場邊休息。我的腳踝迅速腫得像個饅頭一樣。後來爸爸帶我去看了跌打醫生，敷了藥酒。</p>
                <p>這次受傷讓我不得不暫停打球一個月。我明白了運動雖然有益，但也要注意安全，學會保護自己，量力而為。</p>
            </div>
        </div>

        <!-- 6. 遊公園記 -->
        <div id="topic-6" class="content-section">
            <div class="instruction-bar">
                <span>💡 點擊文字即可標記重點</span>
                <button class="btn-clear" onclick="askClearCurrentHighlights()">清除本頁標記</button>
            </div>
            <h1>遊公園記</h1>
            <div class="structure-tag">結構：步移法(地點轉移) ➔ 入口 ➔ 景點一 ➔ 景點二 ➔ 離開/總結</div>

            <div class="fill-in-box">
                <div class="fill-in-title">📝 萬能填充思考區</div>
                <div class="fill-in-content">
                    <p><strong>第一段 (起)：</strong>今天天氣<span class="blank">(天氣)</span>，我和<span class="blank">(誰)</span>一起到<span class="blank">(公園名稱)</span>遊玩。</p>
                    <p><strong>第二段 (承)：</strong>一進大門，我們看見<span class="blank">(景物一)</span>。那裡有<span class="blank">(描述細節)</span>，令人<span class="blank">(感受)</span>。</p>
                    <p><strong>第三段 (轉)：</strong>沿著小徑往前走，我們來到了<span class="blank">(景物二)</span>。我看見許多人在這裡<span class="blank">(活動)</span>，我也<span class="blank">(參與/觀賞)</span>。</p>
                    <p><strong>第四段 (合)：</strong>黃昏時分，我們帶著<span class="blank">(心情)</span>離開公園。這次遊覽讓我<span class="blank">(收穫/感受)</span>。</p>
                </div>
            </div>

            <h3>範本一：香港公園 (觀鳥)</h3>
            <div class="article-text">
                <p>上星期天，風和日麗，爸爸媽媽帶我到香港公園遊玩。那裡風景優美，是鬧市中的綠洲。</p>
                <p>一進公園大門，首先映入眼簾的是一個大型噴水池。水柱隨著音樂高低起伏，在陽光下閃閃發光，美麗極了。接著，我們沿著小徑走到人工湖。湖水碧綠，許多烏龜在石頭上曬太陽。</p>
                <p>然後，我們來到了著名的尤德觀鳥園。走進網狀的巨型鳥籠，彷彿置身於熱帶雨林。各種珍奇的鳥兒在樹枝上歌唱，有的羽毛鮮豔，有的叫聲清脆。</p>
                <p>不知不覺，太陽下山了。我們帶著依依不捨的心情離開公園。這次遊覽讓我親近了大自然，也認識了許多鳥類，真是大開眼界。</p>
            </div>

            <h3>範本二：維多利亞公園 (賞花)</h3>
            <div class="article-text">
                <p>春天到了，百花齊放。老師帶領我們到維多利亞公園參觀一年一度的花展。</p>
                <p>甫進公園，一陣陣花香撲鼻而來。我們首先來到鬱金香花海，紅的、黃的、紫的鬱金香爭相鬥艷，像一幅色彩斑斕的圖畫。同學們都興奮地拿出相機拍照留念。</p>
                <p>穿過花海，我們來到大草坪。草坪中央用鮮花堆砌成各種可愛的動物造型，有大熊貓，也有長頸鹿，栩栩如生。我們圍著這些花壇欣賞，讚嘆園藝師的巧手。</p>
                <p>這次遊公園，我不但欣賞到美麗的花朵，還學到了許多關於植物的知識。大自然真是一位神奇的魔術師啊！</p>
            </div>

            <h3>範本三：家樓下的公園 (遊樂設施)</h3>
            <div class="article-text">
                <p>我家樓下有一個小公園，雖然不大，但卻是我們小朋友的快樂天地。</p>
                <p>每天放學後，我都會和鄰居小明到公園玩耍。公園左邊是遊樂區，有滑梯、鞦韆和攀爬架。我最喜歡玩鞦韆，盪得高高的，風在耳邊呼呼作響，像在天空中飛翔一樣。</p>
                <p>公園的右邊是一個小花園和涼亭。玩累了，我們就會坐在涼亭裡休息，看著老公公老太太在打太極。有時候，我們還會在花叢中捉迷藏，笑聲傳遍了整個公園。</p>
                <p>這個小公園承載了我許多童年的歡樂回憶。雖然它沒有名勝古蹟，但在我心中，它是最有趣的地方。</p>
            </div>
        </div>

        <!-- 7. 一次大掃除的經歷 -->
        <div id="topic-7" class="content-section">
            <div class="instruction-bar">
                <span>💡 點擊文字即可標記重點</span>
                <button class="btn-clear" onclick="askClearCurrentHighlights()">清除本頁標記</button>
            </div>
            <h1>一次大掃除的經歷</h1>
            <div class="structure-tag">結構：大掃除的原因 ➔ 分工合作的過程 ➔ 辛苦但快樂 ➔ 成果/感受</div>

            <div class="fill-in-box">
                <div class="fill-in-title">📝 萬能填充思考區</div>
                <div class="fill-in-content">
                    <p><strong>第一段 (起)：</strong>為了<span class="blank">(原因：迎接新年/保持衛生)</span>，全家人決定進行大掃除。</p>
                    <p><strong>第二段 (承)：</strong>我們分工合作，爸爸負責<span class="blank">(工作)</span>，媽媽負責<span class="blank">(工作)</span>，而我就負責<span class="blank">(工作)</span>。</p>
                    <p><strong>第三段 (轉)：</strong>我拿著<span class="blank">(工具)</span>，用力地<span class="blank">(動作)</span>。雖然累得<span class="blank">(形容詞)</span>，但我沒有放棄，堅持把地方清理乾淨。</p>
                    <p><strong>第四段 (合)：</strong>看著煥然一新的家，我們感到<span class="blank">(心情)</span>。這次勞動讓我體會到<span class="blank">(道理)</span>。</p>
                </div>
            </div>

            <h3>範本一：歲晚大掃除 (迎新春)</h3>
            <div class="article-text">
                <p>農曆新年快到了，為了迎接新的一年，我們全家總動員進行「歲晚大掃除」。媽媽說這叫「除舊迎新」，要把家裡的霉氣都掃走。</p>
                <p>我們分工合作，爸爸負責清潔天花板和風扇，媽媽負責廚房，而我就負責整理自己的房間和擦窗戶。我先把書桌上的雜物收拾好，然後拿著濕布用力地擦窗戶。</p>
                <p>經過一個下午的努力，家裡煥然一新。窗戶明亮得像沒有玻璃一樣，地板乾淨得可以照出人影。看著整潔的家，雖然我們都累得腰酸背痛，但臉上都掛著滿足的笑容。</p>
                <p>這次大掃除讓我體會到做家務的辛勞，也明白了保持家居衛生的重要。能在乾淨舒適的環境裡過年，真是太好了。</p>
            </div>

            <h3>範本二：收拾書房 (整理雜物)</h3>
            <div class="article-text">
                <p>我的書房亂得像個「狗窩」，書本堆積如山，玩具到處都是。媽媽下了「最後通牒」，如果我不整理好，就要把玩具丟掉。</p>
                <p>我只好乖乖地開始大掃除。首先，我把所有的書分類，教科書放一邊，故事書放一邊，整齊地排列在書架上。接著，我拿來一個大箱子，把不再玩的玩具捐贈出去，騰出了許多空間。</p>
                <p>最難處理的是積滿灰塵的角落。我戴上口罩，拿著掃把和拖把，鑽進桌子底下清掃。灰塵嗆得我直咳嗽，但我還是堅持把每個死角都清理乾淨。</p>
                <p>看著整齊有序的書房，我感到非常有成就感。現在找東西方便多了，我也下定決心以後要養成用完東西放回原處的好習慣。</p>
            </div>

            <h3>範本三：校園清潔日 (團體合作)</h3>
            <div class="article-text">
                <p>今天是學校的「清潔日」，我們班的任務是打掃課室。老師分配好工作後，大家便熱火朝天地幹了起來。</p>
                <p>男同學力氣大，負責搬桌椅和擦黑板；女同學細心，負責擦窗戶和掃地。我負責擦風扇，雖然爬上爬下有點累，但看著風扇葉片變乾淨，心裡很高興。有些頑固的污漬很難擦掉，同學主動過來幫忙，我們合力把它擦得乾乾淨淨。</p>
                <p>大掃除結束後，課室變得窗明几淨，空氣也清新了許多。老師稱讚我們是勤勞的小蜜蜂。</p>
                <p>這次活動讓我明白了團結力量大的道理。只要大家齊心協力，再髒再累的工作也能輕鬆完成。</p>
            </div>
        </div>

        <!-- 8. 我的好朋友 -->
        <div id="topic-8" class="content-section">
            <div class="instruction-bar">
                <span>💡 點擊文字即可標記重點</span>
                <button class="btn-clear" onclick="askClearCurrentHighlights()">清除本頁標記</button>
            </div>
            <h1>我的好朋友</h1>
            <div class="structure-tag">結構：外貌描寫 ➔ 性格特點 ➔ 記述一件事表現其性格 ➔ 總結友誼</div>

            <div class="fill-in-box">
                <div class="fill-in-title">📝 萬能填充思考區</div>
                <div class="fill-in-content">
                    <p><strong>第一段 (起)：</strong>我的好朋友叫<span class="blank">(名字)</span>。他長得<span class="blank">(外貌描寫：高/瘦/眼睛大)</span>，性格十分<span class="blank">(性格：開朗/樂於助人)</span>。</p>
                    <p><strong>第二段 (承)：</strong>記得有一次，<span class="blank">(發生了甚麼事)</span>，我感到很<span class="blank">(心情)</span>。</p>
                    <p><strong>第三段 (轉)：</strong>這時，<span class="blank">(名字)</span>主動<span class="blank">(他做了甚麼)</span>。在他的幫助下，<span class="blank">(結果)</span>。</p>
                    <p><strong>第四段 (合)：</strong>我很慶幸有這樣的好朋友。我希望我們的友誼能<span class="blank">(願望)</span>。</p>
                </div>
            </div>

            <h3>範本一：樂於助人的小美 (學業互助)</h3>
            <div class="article-text">
                <p>我的好朋友叫小美，她有一雙水汪汪的大眼睛，笑起來還有兩個可愛的小酒窩。她不但成績優異，而且心地善良，十分樂於助人。</p>
                <p>記得有一次，我的數學測驗不及格，心情非常低落，獨自坐在角落裡發呆。小美看見了，主動走過來安慰我，還提出每天放學後幫我補習。</p>
                <p>在接下來的一個月裡，她犧牲了自己的玩耍時間，耐心地教我做數學題。每當我遇到不懂的地方，她總是不厭其煩地講解，直到我明白為止。在她的幫助下，我的數學成績終於有了進步。</p>
                <p>我很慶幸能有小美這樣的好朋友。她在我困難時伸出援手，讓我感受到友誼的可貴。我希望我們的友誼能天長地久。</p>
            </div>

            <h3>範本二：幽默的大強 (開心果)</h3>
            <div class="article-text">
                <p>大強是我們班的「開心果」，他長得胖嘟嘟的，圓圓的臉上總是掛著笑容。他性格開朗幽默，只要有他在的地方，就充滿了笑聲。</p>
                <p>有一次，我們班在拔河比賽中輸了，大家都垂頭喪氣，氣氛十分沉重。這時，大強走到課室中央，模仿起猩猩走路的樣子，還做著各種滑稽的鬼臉。</p>
                <p>看著他那逗趣的模樣，原本愁眉苦臉的同學們都忍不住「撲哧」一聲笑了出來。大強見大家笑了，便說：「一次失敗算什麼？下次我們吃飽飯，用力拉回來就是了！」</p>
                <p>大強就是這樣一個樂觀的人，他總能用幽默化解煩惱。和他做朋友，我的生活也變得更加快樂了。</p>
            </div>

            <h3>範本三：正直的明輝 (誠實榜樣)</h3>
            <div class="article-text">
                <p>明輝是我的鄰居，也是我最好的朋友。他戴著一副黑框眼鏡，看起來斯斯文文，但他非常正直，很有原則。</p>
                <p>記得有一次，我們去便利店買零食。店員阿姨忙中有錯，多找了十元給明輝。我們走出店門後，明輝發現了這件事。我開玩笑說：「太好了，我們可以多買一杯雪糕吃！」</p>
                <p>明輝卻嚴肅地搖搖頭說：「不行，這是不誠實的行為。」說完，他立刻轉身跑回店裡，把錢退還給阿姨。阿姨稱讚他是個誠實的好孩子。</p>
                <p>明輝的行為讓我感到慚愧，也讓我對他肅然起敬。他教會了我做人要光明磊落，是我學習的好榜樣。</p>
            </div>
        </div>

        <!-- 9. 一次遲到的教訓 -->
        <div id="topic-9" class="content-section">
            <div class="instruction-bar">
                <span>💡 點擊文字即可標記重點</span>
                <button class="btn-clear" onclick="askClearCurrentHighlights()">清除本頁標記</button>
            </div>
            <h1>一次遲到的教訓</h1>
            <div class="structure-tag">結構：遲到原因 ➔ 趕路過程/焦急 ➔ 遲到後果/被罰 ➔ 反省/改過</div>

            <div class="fill-in-box">
                <div class="fill-in-title">📝 萬能填充思考區</div>
                <div class="fill-in-content">
                    <p><strong>第一段 (起)：</strong>昨晚因為<span class="blank">(原因：看電視/打機)</span>，我直到深夜才睡。結果今天早上<span class="blank">(情況：睡過頭)</span>。</p>
                    <p><strong>第二段 (承)：</strong>我醒來一看鐘，嚇得<span class="blank">(動作)</span>。我匆匆忙忙地出門，一路上<span class="blank">(心情/趕路描寫)</span>。</p>
                    <p><strong>第三段 (轉)：</strong>當我回到學校時，已經<span class="blank">(時間/情況)</span>。老師<span class="blank">(處罰/批評)</span>，同學們也<span class="blank">(反應)</span>。</p>
                    <p><strong>第四段 (合)：</strong>這次遲到讓我感到十分<span class="blank">(心情)</span>。我決定以後要<span class="blank">(改進方法)</span>，做個守時的好學生。</p>
                </div>
            </div>

            <h3>範本一：貪睡誤事 (日常生活)</h3>
            <div class="article-text">
                <p>「鈴鈴鈴……」鬧鐘響個不停，我伸手把它按掉，心想：再睡五分鐘吧。沒想到這一睡，就睡過頭了。</p>
                <p>當我醒來時，發現已經八點了！我嚇得從床上跳起來，胡亂地穿上校服，連早餐都沒吃就衝出家門。等巴士的時候，我急得像熱鍋上的螞蟻，不停地看手錶。</p>
                <p>當我氣喘吁吁地跑到學校時，大門已經關上了。我被風紀員記了名字，回到課室還被老師批評了一頓。同學們都看著我，我羞愧得無地自容。</p>
                <p>這次遲到的教訓讓我明白到守時的重要性。貪睡幾分鐘，卻換來了這麼嚴重的後果。我決定以後早睡早起，絕不再讓懶惰害了自己。</p>
            </div>

            <h3>範本二：沉迷遊戲 (玩物喪志)</h3>
            <div class="article-text">
                <p>昨天晚上，我偷偷拿了爸爸的手機玩遊戲，玩得興高采烈，不知不覺玩到了凌晨一點。媽媽催我睡覺，我還敷衍了事。</p>
                <p>結果第二天早上，無論鬧鐘怎麼響，我都聽不見。直到媽媽大聲喝斥，我才驚醒過來。一看時間，慘了！要遲到了！我連牙都沒刷乾淨，抓起書包就往外跑。</p>
                <p>因為遲到，我錯過了早會，還被罰站。站在走廊上，看著其他同學在專心上課，我心裡後悔極了。因為一時的貪玩，導致精神不振，還影響了學習。</p>
                <p>經過這件事，我把手機還給了爸爸，並承諾以後在做完功課和休息時間才適度娛樂。我要做個有自制力的孩子。</p>
            </div>

            <h3>範本三：錯過校車 (動作慢吞吞)</h3>
            <div class="article-text">
                <p>我做事總是慢吞吞的，媽媽常叫我「慢郎中」。今天早上，我依然慢條斯理地吃早餐、穿鞋子，完全沒有時間觀念。</p>
                <p>當我慢悠悠地走到校車站時，只能眼睜睜地看著校車的尾巴消失在轉角處。我頓時慌了神，只好打電話向媽媽求救。媽媽雖然生氣，但還是請假送我去學校。</p>
                <p>雖然最後趕到了學校，但因為遲到，我被扣了操行分，還連累媽媽上班遲到。看著媽媽匆忙離去的背影，我心裡很難過。</p>
                <p>這次教訓讓我明白，時間是不等人的。我必須改掉拖延的壞習慣，學會管理時間，做事要迅速俐落。</p>
            </div>
        </div>

        <!-- 10. 發生在小息時的一件事 -->
        <div id="topic-10" class="content-section">
            <div class="instruction-bar">
                <span>💡 點擊文字即可標記重點</span>
                <button class="btn-clear" onclick="askClearCurrentHighlights()">清除本頁標記</button>
            </div>
            <h1>發生在小息時的一件事</h1>
            <div class="structure-tag">結構：小息環境 ➔ 事件發生 ➔ 解決過程 ➔ 反省/感受</div>

            <div class="fill-in-box">
                <div class="fill-in-title">📝 萬能填充思考區</div>
                <div class="fill-in-content">
                    <p><strong>第一段 (起)：</strong>小息鐘聲響起，操場上<span class="blank">(環境描寫)</span>。我和同學在<span class="blank">(做甚麼)</span>。</p>
                    <p><strong>第二段 (承)：</strong>突然，<span class="blank">(發生了甚麼意外/衝突)</span>。當時氣氛<span class="blank">(形容詞)</span>，大家都<span class="blank">(反應)</span>。</p>
                    <p><strong>第三段 (轉)：</strong>這時，<span class="blank">(誰)</span>出來<span class="blank">(解決方法/調解)</span>。最後，<span class="blank">(結果)</span>。</p>
                    <p><strong>第四段 (合)：</strong>這件事讓我明白到<span class="blank">(道理：如包容/小心)</span>，以後我會<span class="blank">(行動)</span>。</p>
                </div>
            </div>

            <h3>範本一：意外碰撞 (寬容)</h3>
            <div class="article-text">
                <p>「鈴——」小息的鐘聲響起，同學們像小鳥一樣飛出課室。操場上頓時充滿了歡笑聲，有的在跳繩，有的在吃東西，十分熱鬧。</p>
                <p>我和小明在玩追逐遊戲。突然，我不小心撞到了正拿著果汁的小華，果汁灑了他一身。小華生氣地推了我一下，大聲說：「你長不長眼睛啊？」我當時也很衝動，正想罵回去。</p>
                <p>但我看到他衣服上的污漬，我愣住了。我深吸一口氣，冷靜下來，連忙向他道歉：「對不起，我不是故意的，我幫你擦乾淨吧。」小華見我態度誠懇，怒氣也消了。</p>
                <p>這場風波終於平息了。這件事讓我明白，與同學相處要互相包容，發生摩擦時要冷靜處理，主動道歉是解決問題的最好方法。</p>
            </div>

            <h3>範本二：分享零食 (友愛)</h3>
            <div class="article-text">
                <p>今天小息，我帶了一包美味的薯片回學校。剛打開包裝，香氣就吸引了周圍的同學。</p>
                <p>這時，我看見坐在角落的新同學小強，他沒有帶零食，孤零零地看著我們。我想起老師說過要關愛新同學，於是我主動走過去，把薯片遞給他：「小強，請你吃！」</p>
                <p>小強驚訝地抬起頭，害羞地拿了一片，小聲說了句謝謝。其他同學見狀，也紛紛過來邀請小強一起玩耍。很快，小強就融入了我們的圈子，臉上露出了燦爛的笑容。</p>
                <p>看著大家開心的樣子，我手裡的薯片似乎變得更好吃了。原來分享不僅能帶來快樂，還能建立友誼。</p>
            </div>

            <h3>範本三：拾金不昧 (誠實)</h3>
            <div class="article-text">
                <p>小息時，我在小賣部排隊買飲品。突然，我看見前面的同學掉了一張二十元紙幣，但他毫不知情地走了。</p>
                <p>我撿起那張紙幣，心想：這夠我買好多零食了。但是，另一個聲音告訴我：不是自己的東西不能拿。那位同學發現錢不見了一定很著急。</p>
                <p>於是我毫不猶豫地追上去，拍拍那位同學的肩膀，把錢還給他。他感激地說：「謝謝你！如果沒有這筆錢，我就不能買午餐了。」</p>
                <p>雖然我沒有得到物質上的回報，但心裡卻感到很踏實。這件小事讓我再次確認了誠實的重要性。</p>
            </div>
        </div>

        <!-- 11. 我最喜歡的課外活動 -->
        <div id="topic-11" class="content-section">
            <div class="instruction-bar">
                <span>💡 點擊文字即可標記重點</span>
                <button class="btn-clear" onclick="askClearCurrentHighlights()">清除本頁標記</button>
            </div>
            <h1>我最喜歡的課外活動</h1>
            <div class="structure-tag">結構：介紹活動 ➔ 學習過程/樂趣 ➔ 遇到的困難與克服 ➔ 得著</div>

            <div class="fill-in-box">
                <div class="fill-in-title">📝 萬能填充思考區</div>
                <div class="fill-in-content">
                    <p><strong>第一段 (起)：</strong>我有許多課外活動，但我最喜歡的是<span class="blank">(活動名稱)</span>。</p>
                    <p><strong>第二段 (承)：</strong>每逢<span class="blank">(時間)</span>，我就會去練習。剛開始學的時候，我覺得<span class="blank">(困難/感受)</span>，但我沒有放棄。</p>
                    <p><strong>第三段 (轉)：</strong>經過不斷的練習，我終於<span class="blank">(進步/成就)</span>。當我<span class="blank">(進行活動時的描寫)</span>，我感到無比<span class="blank">(心情)</span>。</p>
                    <p><strong>第四段 (合)：</strong>這項活動不但<span class="blank">(好處一：如強身健體)</span>，還培養了我的<span class="blank">(好處二：如耐性)</span>。我會繼續努力。</p>
                </div>
            </div>

            <h3>範本一：彈鋼琴 (陶冶性情)</h3>
            <div class="article-text">
                <p>我有許多課外活動，如畫畫、游泳等，但我最喜歡的還是彈鋼琴。每當手指在黑白琴鍵上飛舞，我就感到無比快樂。</p>
                <p>剛開始學琴時，我覺得很枯燥，手指也不聽使喚，總是彈錯音。看著密密麻麻的五線譜，我曾經想過放棄。但是媽媽鼓勵我說：「台上一分鐘，台下十年功。」於是我堅持每天練習一小時。</p>
                <p>慢慢地，我能彈出動聽的樂曲了。當我彈奏《夢中的婚禮》時，美妙的旋律彷彿帶我進入了童話世界，所有的煩惱都消失了。</p>
                <p>彈鋼琴不但陶冶了我的性情，還培養了我的耐性。我會繼續努力練習，希望將來能成為一名鋼琴家。</p>
            </div>

            <h3>範本二：踢足球 (團隊精神)</h3>
            <div class="article-text">
                <p>我是一個好動的男孩，最喜歡的課外活動就是踢足球。每逢週末，我都會穿上球衣，到球場上奔馳。</p>
                <p>記得剛加入足球隊時，我只顧著自己帶球衝鋒，結果常常被對手截球。教練告訴我：「足球是團體運動，不是個人表演。」從此，我學會了傳球和配合。</p>
                <p>在一次比賽中，我們落後一分。隊友們沒有氣餒，互相鼓勵。在最後一刻，隊友把球傳給我，我看準機會，起腳一射，「球進了！」我們反敗為勝，興奮地擁抱在一起。</p>
                <p>踢足球讓我鍛鍊了強健的體魄，更讓我明白了團結合作的重要性。這種並肩作戰的感覺真好！</p>
            </div>

            <h3>範本三：繪畫 (發揮創意)</h3>
            <div class="article-text">
                <p>我喜歡安靜，所以繪畫成了我最喜愛的課外活動。只要給我一張紙和一盒顏色筆，我就能畫出一個奇妙的世界。</p>
                <p>在畫畫班裡，老師教我們觀察事物的光影和色彩。有時候，為了畫好一朵花，我會觀察它很久。雖然過程需要極大的專注力，但我樂在其中。</p>
                <p>我最喜歡畫風景畫。藍天、白雲、綠樹、紅花，這些美麗的景色在我的筆下變得栩栩如生。當我把作品展示給家人看時，他們的讚賞是我最大的動力。</p>
                <p>繪畫讓我發揮無窮的創意，也讓我學會了用美的眼光去觀察世界。我希望將來能舉辦自己的畫展。</p>
            </div>
        </div>

        <!-- 12. 我最喜愛的節日 -->
        <div id="topic-12" class="content-section">
            <div class="instruction-bar">
                <span>💡 點擊文字即可標記重點</span>
                <button class="btn-clear" onclick="askClearCurrentHighlights()">清除本頁標記</button>
            </div>
            <h1>我最喜愛的節日</h1>
            <div class="structure-tag">結構：是什麼節日 ➔ 節日氣氛/習俗 ➔ 具體活動 ➔ 喜愛的原因</div>

            <div class="fill-in-box">
                <div class="fill-in-title">📝 萬能填充思考區</div>
                <div class="fill-in-content">
                    <p><strong>第一段 (起)：</strong>一年之中有許多節日，但我最喜愛的是<span class="blank">(節日名稱)</span>。因為這是一個<span class="blank">(形容詞)</span>的節日。</p>
                    <p><strong>第二段 (承)：</strong>在這個節日裡，到處都<span class="blank">(節日氣氛/佈置)</span>。我們會<span class="blank">(習俗活動)</span>，還會吃<span class="blank">(應節食品)</span>。</p>
                    <p><strong>第三段 (轉)：</strong>最令我難忘的是<span class="blank">(具體事件)</span>。當時我們<span class="blank">(做甚麼)</span>，感到十分<span class="blank">(心情)</span>。</p>
                    <p><strong>第四段 (合)：</strong>我喜愛這個節日，因為它不但<span class="blank">(好處)</span>，更重要的是能<span class="blank">(意義：如家人團聚)</span>。</p>
                </div>
            </div>

            <h3>範本一：農曆新年 (團圓)</h3>
            <div class="article-text">
                <p>一年之中有許多節日，但我最喜愛的是農曆新年。因為這是一個充滿喜慶和歡樂的節日，到處都張燈結綵，喜氣洋洋。</p>
                <p>大年初一早上，我穿上紅彤彤的新衣服，向爸爸媽媽拜年，祝他們身體健康。爸爸媽媽會給我壓歲錢，寓意快高長大。家裡擺滿了年花和全盒，客人來拜年時，我們會互相祝福。</p>
                <p>最令我興奮的是晚上的煙花匯演。璀璨的煙花在夜空中綻放，五彩繽紛，把維多利亞港照得如同白晝。我們一家人一邊欣賞煙花，一邊吃著美味的年糕，感覺溫馨極了。</p>
                <p>農曆新年不但有紅包收，有美食吃，更重要的是一家團圓。這種濃厚的親情和歡樂的氣氛，讓我深深愛上了這個傳統節日。</p>
            </div>

            <h3>範本二：中秋節 (賞月)</h3>
            <div class="article-text">
                <p>「八月十五月兒圓」，中秋節是我最喜愛的節日。這一天，月亮特別圓，特別亮，象徵著團圓和美好。</p>
                <p>晚飯後，我們一家人帶著燈籠和月餅到公園賞月。公園裡掛滿了五顏六色的燈籠，有兔子形狀的，也有楊桃形狀的，十分漂亮。小朋友們提著燈籠跑來跑去，像一群快樂的螢火蟲。</p>
                <p>我們坐在草地上，一邊吃著甜甜的月餅，一邊抬頭欣賞明月。爸爸還給我講了「嫦娥奔月」的故事，我覺得非常有趣。</p>
                <p>中秋節讓我感受到家庭的溫暖和大自然的寧靜。看著圓圓的月亮，我希望每個人都能和家人團團圓圓，幸福快樂。</p>
            </div>

            <h3>範本三：端午節 (熱鬧)</h3>
            <div class="article-text">
                <p>端午節是紀念愛國詩人屈原的節日，也是我非常喜歡的節日，因為這一天有激烈的龍舟比賽。</p>
                <p>那天，我和爸爸媽媽去城門河看龍舟競渡。河邊擠滿了觀眾，鑼鼓喧天，熱鬧非凡。只見一艘艘龍舟像箭一樣在水面上飛馳，健兒們隨著鼓聲奮力划槳，水花四濺。</p>
                <p>我們在岸上大聲吶喊助威：「加油！加油！」最後，我支持的隊伍奪得了冠軍，我高興得跳了起來。看完比賽，回到家還有香噴噴的粽子吃，真是大飽口福。</p>
                <p>端午節不但氣氛熱鬧，充滿活力，還讓我了解了中國的傳統文化，真是一個有意義的節日。</p>
            </div>
        </div>

    </div>

    <script>
        // --- 安全存儲封裝 (解決 Sandbox 報錯問題) ---
        const safeStorage = {
            _memory: {},
            isAvailable: function() {
                try {
                    const test = '__storage_test__';
                    localStorage.setItem(test, test);
                    localStorage.removeItem(test);
                    return true;
                } catch (e) {
                    return false;
                }
            }(),
            getItem: function(key) {
                if (this.isAvailable) {
                    return localStorage.getItem(key);
                }
                return this._memory[key] || null;
            },
            setItem: function(key, value) {
                if (this.isAvailable) {
                    try {
                        localStorage.setItem(key, value);
                    } catch(e) { console.warn('Storage full or error', e); }
                } else {
                    this._memory[key] = value;
                }
            },
            removeItem: function(key) {
                if (this.isAvailable) {
                    localStorage.removeItem(key);
                } else {
                    delete this._memory[key];
                }
            }
        };

        // --- 自製確認視窗邏輯 ---
        let onConfirmCallback = null;

        function showConfirm(message, callback) {
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmModal').classList.add('active');
            document.getElementById('overlay').classList.add('active');
            onConfirmCallback = callback;
            
            const yesBtn = document.getElementById('confirmYesBtn');
            const newYesBtn = yesBtn.cloneNode(true);
            yesBtn.parentNode.replaceChild(newYesBtn, yesBtn);
            
            newYesBtn.addEventListener('click', () => {
                closeConfirmModal();
                if (onConfirmCallback) onConfirmCallback();
            });
        }

        function closeConfirmModal() {
            document.getElementById('confirmModal').classList.remove('active');
            if (!document.getElementById('sidebar').classList.contains('open')) {
                document.getElementById('overlay').classList.remove('active');
            }
        }

        // --- 應用程式邏輯 ---

        const defaultTopics = [
            { id: 1, title: "一次難忘的經歷" },
            { id: 2, title: "我做了一件好事" },
            { id: 3, title: "一次生病的經過" },
            { id: 4, title: "快樂的聖誕聯歡會" },
            { id: 5, title: "受傷了" },
            { id: 6, title: "遊公園記" },
            { id: 7, title: "一次大掃除的經歷" },
            { id: 8, title: "我的好朋友" },
            { id: 9, title: "一次遲到的教訓" },
            { id: 10, title: "發生在小息時的一件事" },
            { id: 11, title: "我最喜歡的課外活動" },
            { id: 12, title: "我最喜愛的節日" }
        ];

        let topics = [];

        const STORAGE_KEY_HIGHLIGHTS = 'essay_highlights_v2';
        const STORAGE_KEY_NOTES = 'essay_custom_notes_v1';
        const STORAGE_KEY_ORDER = 'essay_topic_order_v1';

        document.addEventListener('DOMContentLoaded', () => {
            try {
                loadTopicOrder(); 
                renderMenu();
                processTextAndLoadHighlights(); 
                loadCustomNotes();
                
                if(topics.length > 0) {
                    switchTopic(topics[0].id, topics[0].title, false);
                }
            } catch (e) {
                console.error("Initialization error:", e);
                document.querySelector('.main-content').innerHTML += `<div style="color:red; padding:20px;">系統初始化錯誤，請嘗試刷新頁面。錯誤詳情: ${e.message}</div>`;
            }
        });

        // --- 排序功能 ---
        function loadTopicOrder() {
            let savedOrder = null;
            try {
                const data = safeStorage.getItem(STORAGE_KEY_ORDER);
                if (data) savedOrder = JSON.parse(data);
            } catch (e) { console.warn("Error parsing order", e); }
            
            if (savedOrder && Array.isArray(savedOrder)) {
                topics = [];
                savedOrder.forEach(id => {
                    const found = defaultTopics.find(t => t.id === id);
                    if (found) topics.push(found);
                });
                defaultTopics.forEach(t => {
                    if (!topics.find(saved => saved.id === t.id)) {
                        topics.push(t);
                    }
                });
            } else {
                topics = [...defaultTopics];
            }
        }

        function saveOrder() {
            const order = topics.map(t => t.id);
            safeStorage.setItem(STORAGE_KEY_ORDER, JSON.stringify(order));
        }

        function askResetOrder() {
            showConfirm("確定要重置目錄順序嗎？", () => {
                safeStorage.removeItem(STORAGE_KEY_ORDER);
                location.reload();
            });
        }

        // --- 選單控制 ---
        function openSidebar() {
            document.getElementById('sidebar').classList.add('open');
            document.getElementById('overlay').classList.add('active');
        }

        function closeSidebar() {
            document.getElementById('sidebar').classList.remove('open');
            if (!document.getElementById('confirmModal').classList.contains('active')) {
                document.getElementById('overlay').classList.remove('active');
            }
        }

        // --- 拖拽功能 ---
        let dragSrcEl = null;

        function handleDragStart(e) {
            dragSrcEl = this;
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.innerHTML);
            this.classList.add('dragging');
        }

        function handleDragOver(e) {
            if (e.preventDefault) { e.preventDefault(); }
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDragEnter(e) { this.classList.add('over'); }
        function handleDragLeave(e) { this.classList.remove('over'); }

        function handleDrop(e) {
            if (e.stopPropagation) { e.stopPropagation(); }

            if (dragSrcEl !== this) {
                const srcIndex = parseInt(dragSrcEl.getAttribute('data-index'));
                const targetIndex = parseInt(this.getAttribute('data-index'));

                const itemToMove = topics[srcIndex];
                topics.splice(srcIndex, 1);
                topics.splice(targetIndex, 0, itemToMove);

                saveOrder();
                renderMenu();
            }
            return false;
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            let items = document.querySelectorAll('.menu-list .menu-item');
            items.forEach(function (item) {
                item.classList.remove('over');
            });
        }

        function renderMenu() {
            const menuList = document.getElementById('menuList');
            menuList.innerHTML = ''; 

            const notebookLi = document.createElement('li');
            notebookLi.className = 'menu-item special-item';
            notebookLi.innerHTML = '🌟 我的重點筆記本';
            notebookLi.onclick = () => {
                openNotebook();
                closeSidebar();
            };
            menuList.appendChild(notebookLi);

            topics.forEach((topic, index) => {
                const li = document.createElement('li');
                li.className = 'menu-item draggable-item';
                li.setAttribute('draggable', 'true');
                li.setAttribute('data-id', topic.id);
                li.setAttribute('data-index', index);
                
                li.innerHTML = `<span class="drag-handle">☰</span> ${index + 1}. ${topic.title}`;
                
                li.onclick = (e) => {
                    switchTopic(topic.id, topic.title, true);
                };

                li.addEventListener('dragstart', handleDragStart, false);
                li.addEventListener('dragenter', handleDragEnter, false);
                li.addEventListener('dragover', handleDragOver, false);
                li.addEventListener('dragleave', handleDragLeave, false);
                li.addEventListener('drop', handleDrop, false);
                li.addEventListener('dragend', handleDragEnd, false);

                menuList.appendChild(li);
            });
        }

        function switchTopic(id, title, autoClose = true) {
            document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));

            const targetSection = document.getElementById(`topic-${id}`);
            if (targetSection) {
                targetSection.classList.add('active');
                document.querySelector('.main-content').scrollTop = 0;
            }
            
            const menuItem = document.querySelector(`.menu-item[data-id="${id}"]`);
            if (menuItem) {
                menuItem.classList.add('active');
            }

            document.getElementById('currentTitle').textContent = title;

            if (autoClose) closeSidebar();
        }

        // --- 筆記本功能 ---

        function openNotebook() {
            document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));

            document.getElementById('notebook-view').classList.add('active');
            document.querySelector('.menu-item.special-item').classList.add('active');
            document.getElementById('currentTitle').textContent = "我的重點筆記本";
            document.querySelector('.main-content').scrollTop = 0;

            renderArticleHighlightsInNotebook();
        }

        function renderArticleHighlightsInNotebook() {
            const listEl = document.getElementById('articleHighlightsList');
            listEl.innerHTML = '';

            const highlights = document.querySelectorAll('.phrase.highlight');

            if (highlights.length === 0) {
                listEl.innerHTML = '<li class="empty-msg">還沒有標記任何重點，快去文章中點擊你喜歡的句子吧！</li>';
                return;
            }

            const groupedData = {};

            highlights.forEach(el => {
                const section = el.closest('.content-section');
                if (section) {
                    const title = section.querySelector('h1').innerText;
                    if (!groupedData[title]) {
                        groupedData[title] = [];
                    }
                    groupedData[title].push(el.innerText);
                }
            });

            for (const [title, texts] of Object.entries(groupedData)) {
                texts.forEach(text => {
                    const li = document.createElement('li');
                    li.className = 'notebook-item source-article';
                    li.innerHTML = `
                        <div class="notebook-content">
                            ${text}
                            <span class="notebook-source">來自：${title}</span>
                        </div>
                    `;
                    listEl.appendChild(li);
                });
            }
        }

        // --- 自訂筆記功能 ---
        
        function addCustomNote() {
            const input = document.getElementById('customNoteInput');
            const text = input.value.trim();
            
            if (!text) return;

            let notes = [];
            try {
                const data = safeStorage.getItem(STORAGE_KEY_NOTES);
                if(data) notes = JSON.parse(data);
            } catch(e) {}
            
            notes.push({
                id: Date.now(),
                text: text
            });

            safeStorage.setItem(STORAGE_KEY_NOTES, JSON.stringify(notes));
            input.value = '';
            loadCustomNotes();
        }

        function askDeleteCustomNote(id) {
            showConfirm("確定要刪除這條筆記嗎？", () => {
                let notes = [];
                try {
                    const data = safeStorage.getItem(STORAGE_KEY_NOTES);
                    if(data) notes = JSON.parse(data);
                } catch(e) {}

                notes = notes.filter(note => note.id !== id);
                
                safeStorage.setItem(STORAGE_KEY_NOTES, JSON.stringify(notes));
                loadCustomNotes();
            });
        }

        function loadCustomNotes() {
            const listEl = document.getElementById('customNoteList');
            listEl.innerHTML = '';
            
            let notes = [];
            try {
                const data = safeStorage.getItem(STORAGE_KEY_NOTES);
                if(data) notes = JSON.parse(data);
            } catch(e) {}

            if (notes.length === 0) {
                listEl.innerHTML = '<li class="empty-msg">你還沒有加入自訂筆記。</li>';
                return;
            }

            notes.reverse().forEach(note => {
                const li = document.createElement('li');
                li.className = 'notebook-item source-custom';
                li.innerHTML = `
                    <div class="notebook-content">
                        ${note.text}
                        <span class="notebook-source">自行加入</span>
                    </div>
                    <button class="delete-note-btn" onclick="askDeleteCustomNote(${note.id})">×</button>
                `;
                listEl.appendChild(li);
            });
        }

        // --- 原有文本處理與標記功能 ---

        function processTextAndLoadHighlights() {
            const sections = document.querySelectorAll('.content-section');
            
            sections.forEach(section => {
                if(section.id === 'notebook-view') return;

                const topicId = section.id; 
                // 選擇所有 .article-text 內的 p，這樣可以涵蓋多個範本
                const paragraphs = section.querySelectorAll('.article-text p');
                
                paragraphs.forEach((p, pIndex) => {
                    const originalText = p.innerText;
                    const regex = /([^，。！？、；：…\n]+[，。！？、；：…\n]*)/g;
                    
                    const newHtml = originalText.replace(regex, (match) => {
                        return `<span class="phrase">${match}</span>`;
                    });

                    p.innerHTML = newHtml;

                    const spans = p.querySelectorAll('.phrase');
                    spans.forEach((span, sIndex) => {
                        // 為了避免不同範本的段落索引衝突，這裡其實最好加上範本索引
                        // 但為了保持簡單，只要 pIndex 是全頁面唯一的即可
                        // querySelectorAll 返回的是文檔順序，所以 pIndex 是唯一的
                        const uniqueKey = `${topicId}-p${pIndex}-s${sIndex}`;
                        span.setAttribute('data-key', uniqueKey);
                    });
                });
            });

            loadHighlightsFromStorage();
            document.querySelector('.main-content').addEventListener('click', handlePhraseClick);
        }

        function loadHighlightsFromStorage() {
            try {
                const data = safeStorage.getItem(STORAGE_KEY_HIGHLIGHTS);
                const savedData = data ? JSON.parse(data) : {};
                for (const key in savedData) {
                    if (savedData[key] === true) {
                        const el = document.querySelector(`.phrase[data-key="${key}"]`);
                        if (el) {
                            el.classList.add('highlight');
                        }
                    }
                }
            } catch (e) {
                console.error("讀取存檔失敗", e);
            }
        }

        function handlePhraseClick(e) {
            const el = e.target.closest('.phrase');
            
            if (el) {
                const key = el.getAttribute('data-key');
                if (!key) return;

                el.classList.toggle('highlight');
                
                let savedData = {};
                try {
                    const data = safeStorage.getItem(STORAGE_KEY_HIGHLIGHTS);
                    if(data) savedData = JSON.parse(data);
                } catch(e) {}
                
                if (el.classList.contains('highlight')) {
                    savedData[key] = true;
                } else {
                    delete savedData[key];
                }
                
                safeStorage.setItem(STORAGE_KEY_HIGHLIGHTS, JSON.stringify(savedData));
            }
        }

        function askClearCurrentHighlights() {
            showConfirm("確定要清除本頁的所有標記嗎？", () => {
                const activeSection = document.querySelector('.content-section.active');
                if (activeSection) {
                    const highlights = activeSection.querySelectorAll('.phrase.highlight');
                    
                    let savedData = {};
                    try {
                        const data = safeStorage.getItem(STORAGE_KEY_HIGHLIGHTS);
                        if(data) savedData = JSON.parse(data);
                    } catch(e) {}
                    
                    highlights.forEach(el => {
                        el.classList.remove('highlight');
                        const key = el.getAttribute('data-key');
                        delete savedData[key]; 
                    });

                    safeStorage.setItem(STORAGE_KEY_HIGHLIGHTS, JSON.stringify(savedData));
                }
            });
        }
    </script>
</body>
</html>
